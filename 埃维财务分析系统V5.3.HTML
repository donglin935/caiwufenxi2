<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>投标单位财务分析系统 - 埃维集团</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root {
            --primary-color: #1a4f72;
            --secondary-color: #2c7da0;
            --accent-color: #e63946;
            --light-color: #f8f9fa;
            --dark-color: #2c3e50;
            --success-color: #2a9d8f;
            --warning-color: #e9c46a;
            --danger-color: #e76f51;
        }
        
        body {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
            color: #343a40;
        }
        
        .header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 20px 0;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            position: relative;
            overflow: hidden;
        }
        
        .header::before {
            content: "";
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 70%);
            transform: rotate(30deg);
        }
        
        .logo-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo {
            width: 70px;
            height: 70px;
            background: linear-gradient(135deg, #fff, #e0e0e0);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: var(--primary-color);
            font-size: 24px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        .app-container {
            max-width: 1400px;
            margin: 0 auto 40px;
            background-color: white;
            border-radius: 15px;
            box-shadow: 0 6px 30px rgba(0, 0, 0, 0.12);
            overflow: hidden;
            position: relative;
            z-index: 10;
        }
        
        .nav-tabs {
            background-color: #e9f7fe;
            padding: 0 15px;
            border-bottom: 1px solid #dee2e6;
        }
        
        .nav-tabs .nav-link {
            font-weight: 600;
            color: var(--dark-color);
            padding: 15px 25px;
            border: none;
            border-radius: 0;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .nav-tabs .nav-link:hover {
            background-color: rgba(26, 79, 114, 0.1);
        }
        
        .nav-tabs .nav-link.active {
            background-color: var(--primary-color);
            color: white;
            border: none;
        }
        
        .nav-tabs .nav-link.active::after {
            content: "";
            position: absolute;
            bottom: -1px;
            left: 0;
            width: 100%;
            height: 3px;
            background-color: var(--accent-color);
        }
        
        .tab-content {
            padding: 25px;
        }
        
        .form-section {
            background-color: #ffffff;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
            border: 1px solid #e0e0e0;
        }
        
        .form-title {
            color: var(--primary-color);
            border-bottom: 2px solid var(--secondary-color);
            padding-bottom: 12px;
            margin-bottom: 20px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .form-title i {
            font-size: 1.4rem;
        }
        
        .form-table th {
            background: linear-gradient(to bottom, var(--primary-color), #1a3f5c);
            color: white;
            font-weight: 500;
        }
        
        .form-table input {
            background-color: #f8fafc;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 8px 12px;
            transition: all 0.2s;
        }
        
        .form-table input:focus {
            background-color: #fff;
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 0.25rem rgba(26, 79, 114, 0.15);
        }
        
        .btn-primary {
            background: linear-gradient(to bottom, var(--primary-color), var(--secondary-color));
            border: none;
            padding: 10px 25px;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .btn-primary:hover {
            background: linear-gradient(to bottom, #0d3a5c, #1a5f7a);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(26, 79, 114, 0.3);
        }
        
        .btn-export {
            background: linear-gradient(to bottom, var(--accent-color), #c1121f);
            border: none;
            padding: 10px 25px;
            font-weight: 600;
            color: white;
            transition: all 0.3s;
        }
        
        .btn-export:hover {
            background: linear-gradient(to bottom, #d90429, #9d0208);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(230, 57, 70, 0.3);
        }
        
        .chart-container {
            height: 400px;
            margin: 30px 0;
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
            border: 1px solid #e0e0e0;
        }
        
        .analysis-card {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
            border-left: 5px solid var(--secondary-color);
            transition: transform 0.3s;
        }
        
        .analysis-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .score-card {
            background: linear-gradient(135deg, var(--dark-color), #3d5a80);
            color: white;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
        }
        
        .du-pont-chart {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            margin: 30px 0;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
            border: 1px solid #e0e0e0;
        }
        
        .status-badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            display: inline-block;
            text-align: center;
            min-width: 60px;
            white-space: nowrap;
            line-height: 1.3;
         }
        
        .status-good {
            background-color: #d4edda;
            color: #155724;
        }
        
        .status-warning {
            background-color: #fff3cd;
            color: #856404;
        }
        
        .status-danger {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        .footer {
            background: linear-gradient(135deg, var(--dark-color), #1d3557);
            color: white;
            padding: 25px 0;
            margin-top: 40px;
            text-align: center;
            position: relative;
            z-index: 5;
        }
        
        .indicator-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 25px;
        }
        
        .indicator-card {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
            border-top: 3px solid var(--secondary-color);
            transition: transform 0.3s ease;
        }
        
        .indicator-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .progress {
            height: 12px;
            border-radius: 6px;
        }
        
        .year-tabs .nav-link {
            padding: 12px 20px;
            font-weight: 600;
        }
        
        .year-tabs .nav-link.active {
            background: linear-gradient(to bottom, var(--primary-color), var(--secondary-color));
            color: white;
        }
        
        .table-striped tbody tr:nth-of-type(odd) {
            background-color: rgba(26, 79, 114, 0.05);
        }
        
        .table-hover tbody tr:hover {
            background-color: rgba(26, 79, 114, 0.1);
        }
        
        .section-icon {
            font-size: 24px;
            margin-right: 10px;
            color: var(--secondary-color);
        }
        
        .data-actions {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
            margin-top: 20px;
        }
        
        .data-actions .btn {
            min-width: 150px;
        }
        
        .financial-summary {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .summary-card {
            background: linear-gradient(135deg, #e9f7fe, #d1ebf9);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            min-width: 200px;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.08);
        }
        
        .summary-card h5 {
            color: var(--primary-color);
            margin-bottom: 10px;
            font-weight: 600;
        }
        
        .summary-card .value {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--dark-color);
        }
        
        .summary-card .trend {
            font-size: 0.9rem;
            margin-top: 5px;
        }
        
        .trend-up {
            color: var(--success-color);
        }
        
        .trend-down {
            color: var(--danger-color);
        }
        
        .indicator-table {
            width: 100%;
            font-size: 0.9rem;
        }
        
        .indicator-table th {
            background-color: var(--primary-color);
            color: white;
            padding: 8px;
            text-align: center;
        }
        
        .indicator-table td {
            padding: 8px;
            text-align: center;
        }
        
        .indicator-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        
        .trend-icon {
            font-size: 0.8rem;
            margin-left: 5px;
        }
        
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            display: none;
        }
        
        .spinner-border {
            width: 3rem;
            height: 3rem;
        }
        
        .alert-message {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10000;
            display: none;
        }
        
        .walt-scoring-table tbody tr td:last-child,
        .walt-scoring-table tbody tr td:nth-last-child(2) {
            font-weight: 600;
        }
        
        .unit-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            padding: 5px 15px;
            font-size: 0.9rem;
        }
        
        .fixed-header {
            position: sticky;
            top: 0;
            background: white;
            z-index: 100;
            padding: 15px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        @media (max-width: 768px) {
            .nav-tabs .nav-link {
                padding: 12px 15px;
                font-size: 0.9rem;
            }
            
            .form-title {
                font-size: 1.2rem;
            }
            
            .indicator-grid {
                grid-template-columns: 1fr;
            }
            
            .financial-summary {
                flex-direction: column;
                align-items: center;
            }
            
            .summary-card {
                width: 100%;
            }
            
            .indicator-table {
                font-size: 0.8rem;
            }
            
            .unit-toggle {
                position: static;
                margin-top: 10px;
            }
            
            .status-badge {
                height: 40px;
                width: 25px;
                font-size: 0.75rem;
            }
        }
        
        /* 新增样式 */
        .assessment-panel {
            background: linear-gradient(135deg, #1a4f72, #2c7da0);
            color: white;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .assessment-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .assessment-icon {
            font-size: 28px;
            margin-right: 15px;
            background: rgba(255, 255, 255, 0.2);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .assessment-content {
            font-size: 16px;
            line-height: 1.6;
        }
        
        /* 新增状态竖排样式 */
        .status-cell {
            text-align: center;
            padding: 4px 0;
        }
        
        .negative-score {
            background-color: #f8d7da;
            color: #721c24;
            border-radius: 4px;
            padding: 2px 5px;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div class="loading-overlay" id="loadingOverlay">
        <div class="text-center">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">计算中...</span>
            </div>
            <p class="mt-3">正在计算财务指标并更新分析报告...</p>
        </div>
    </div>
    
    <div class="alert-message alert alert-success alert-dismissible fade show" id="successAlert" role="alert">
        <strong>数据保存成功！</strong> 财务指标和分析报告已更新。
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    
    <div class="alert-message alert alert-danger alert-dismissible fade show" id="errorAlert" role="alert">
        <strong>保存失败！</strong> <span id="errorMessage">请检查输入数据是否正确。</span>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>

    <div class="header">
        <div class="container">
            <div class="logo-container">
                <div class="logo">AW</div>
                <div>
                    <h1>投标单位财务分析系统</h1>
                    <p class="mb-0">埃维集团 - 洲际酒店改造项目</p>
                </div>
            </div>
            <div class="unit-toggle">
                <span>单位：</span>
                <div class="btn-group btn-group-sm">
                    <button class="btn btn-light active" data-unit="yuan">元</button>
                    <button class="btn btn-outline-light" data-unit="thousand">万元</button>
                </div>
            </div>
        </div>
    </div>

    <div class="container app-container">
        <ul class="nav nav-tabs" id="myTab" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="data-tab" data-bs-toggle="tab" data-bs-target="#data" type="button" role="tab">
                    <i class="fas fa-database me-1"></i>数据导入
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="indicators-tab" data-bs-toggle="tab" data-bs-target="#indicators" type="button" role="tab">
                    <i class="fas fa-calculator me-1"></i>财务指标
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="charts-tab" data-bs-toggle="tab" data-bs-target="#charts" type="button" role="tab">
                    <i class="fas fa-chart-line me-1"></i>趋势分析
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="analysis-tab" data-bs-toggle="tab" data-bs-target="#analysis" type="button" role="tab">
                    <i class="fas fa-file-alt me-1"></i>财务分析
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="scoring-tab" data-bs-toggle="tab" data-bs-target="#scoring" type="button" role="tab">
                    <i class="fas fa-star me-1"></i>沃尔评分
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="dupont-tab" data-bs-toggle="tab" data-bs-target="#dupont" type="button" role="tab">
                    <i class="fas fa-sitemap me-1"></i>杜邦分析
                </button>
            </li>
        </ul>
        
        <div class="tab-content" id="myTabContent">
            <!-- 数据导入模块 -->
            <div class="tab-pane fade show active" id="data" role="tabpanel">
                <div class="form-section">
                    <h3 class="form-title"><i class="fas fa-table"></i>财务报表数据录入</h3>
                    <p class="text-muted">请输入投标单位近三年的财务报表数据，系统将自动计算财务指标并进行综合分析。</p>
                    
                    <div class="mb-4">
                        <label class="form-label">选择单位：</label>
                        <select class="form-select" id="company-select">
                            <option value="">-- 选择投标单位 --</option>
                            <option value="company1" selected>中建三局集团有限公司</option>
                            <option value="company2">上海建工集团股份有限公司</option>
                            <option value="company3">北京城建集团有限责任公司</option>
                            <option value="new">+ 添加新单位</option>
                        </select>
                    </div>
                    
                    <ul class="nav nav-tabs year-tabs mb-4" id="yearTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="year1-tab" data-bs-toggle="tab" data-bs-target="#year1" type="button">2022年</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="year2-tab" data-bs-toggle="tab" data-bs-target="#year2" type="button">2023年</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="year3-tab" data-bs-toggle="tab" data-bs-target="#year3" type="button">2024年</button>
                        </li>
                    </ul>
                    
                    <div class="tab-content">
                        <!-- 2022年数据 -->
                        <div class="tab-pane fade show active" id="year1">
                            <div class="row">
                                <div class="col-md-6">
                                    <h5>资产负债表</h5>
                                    <table class="table table-bordered form-table">
                                        <tr>
                                            <th>项目</th>
                                            <th>金额（万元）</th>
                                        </tr>
                                        <tr>
                                            <td>货币资金</td>
                                            <td><input type="number" class="form-control" id="cash-2022" value="15000"></td>
                                        </tr>
                                        <tr>
                                            <td>应收账款</td>
                                            <td><input type="number" class="form-control" id="receivables-2022" value="8500"></td>
                                        </tr>
                                        <tr>
                                            <td>存货</td>
                                            <td><input type="number" class="form-control" id="inventory-2022" value="12000"></td>
                                        </tr>
                                        <tr>
                                            <td>流动资产合计</td>
                                            <td><input type="number" class="form-control" id="current-assets-2022" value="38000"></td>
                                        </tr>
                                        <tr>
                                            <td>固定资产</td>
                                            <td><input type="number" class="form-control" id="fixed-assets-2022" value="42000"></td>
                                        </tr>
                                        <tr>
                                            <td>资产总计</td>
                                            <td><input type="number" class="form-control" id="total-assets-2022" value="92000"></td>
                                        </tr>
                                        <tr>
                                            <td>流动负债合计</td>
                                            <td><input type="number" class="form-control" id="current-liabilities-2022" value="28000"></td>
                                        </tr>
                                        <tr>
                                            <td>非流动负债合计</td>
                                            <td><input type="number" class="form-control" id="non-current-liabilities-2022" value="18000"></td>
                                        </tr>
                                        <tr>
                                            <td>负债合计</td>
                                            <td><input type="number" class="form-control" id="total-liabilities-2022" value="46000"></td>
                                        </tr>
                                        <tr>
                                            <td>所有者权益合计</td>
                                            <td><input type="number" class="form-control" id="equity-2022" value="46000"></td>
                                        </tr>
                                    </table>
                                </div>
                                <div class="col-md-6">
                                    <h5>利润表</h5>
                                    <table class="table table-bordered form-table">
                                        <tr>
                                            <th>项目</th>
                                            <th>金额（万元）</th>
                                        </tr>
                                        <tr>
                                            <td>营业收入</td>
                                            <td><input type="number" class="form-control" id="revenue-2022" value="125000"></td>
                                        </tr>
                                        <tr>
                                            <td>营业成本</td>
                                            <td><input type="number" class="form-control" id="cost-2022" value="95000"></td>
                                        </tr>
                                        <tr>
                                            <td>营业利润</td>
                                            <td><input type="number" class="form-control" id="operating-profit-2022" value="18000"></td>
                                        </tr>
                                        <tr>
                                            <td>利润总额</td>
                                            <td><input type="number" class="form-control" id="total-profit-2022" value="17500"></td>
                                        </tr>
                                        <tr>
                                            <td>净利润</td>
                                            <td><input type="number" class="form-control" id="net-profit-2022" value="13200"></td>
                                        </tr>
                                        <tr>
                                            <td>利息费用</td>
                                            <td><input type="number" class="form-control" id="interest-2022" value="4500"></td>
                                        </tr>
                                        <tr>
                                            <td>折旧与摊销</td>
                                            <td><input type="number" class="form-control" id="depreciation-2022" value="7800"></td>
                                        </tr>
                                    </table>
                                    
                                    <h5 class="mt-4">现金流量表</h5>
                                    <table class="table table-bordered form-table">
                                        <tr>
                                            <th>项目</th>
                                            <th>金额（万元）</th>
                                        </tr>
                                        <tr>
                                            <td>经营活动现金流量净额</td>
                                            <td><input type="number" class="form-control" id="operating-cashflow-2022" value="16500"></td>
                                        </tr>
                                        <tr>
                                            <td>投资活动现金流量净额</td>
                                            <td><input type="number" class="form-control" id="investing-cashflow-2022" value="-12000"></td>
                                        </tr>
                                        <tr>
                                            <td>筹资活动现金流量净额</td>
                                            <td><input type="number" class="form-control" id="financing-cashflow-2022" value="-3500"></td>
                                        </tr>
                                        <tr>
                                            <td>资本支出</td>
                                            <td><input type="number" class="form-control" id="capital-expenditure-2022" value="11000"></td>
                                        </tr>
                                    </table>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 2023年数据 -->
                        <div class="tab-pane fade" id="year2">
                            <div class="row">
                                <div class="col-md-6">
                                    <h5>资产负债表</h5>
                                    <table class="table table-bordered form-table">
                                        <tr>
                                            <th>项目</th>
                                            <th>金额（万元）</th>
                                        </tr>
                                        <tr>
                                            <td>货币资金</td>
                                            <td><input type="number" class="form-control" id="cash-2023" value="16800"></td>
                                        </tr>
                                        <tr>
                                            <td>应收账款</td>
                                            <td><input type="number" class="form-control" id="receivables-2023" value="9200"></td>
                                        </tr>
                                        <tr>
                                            <td>存货</td>
                                            <td><input type="number" class="form-control" id="inventory-2023" value="13500"></td>
                                        </tr>
                                        <tr>
                                            <td>流动资产合计</td>
                                            <td><input type="number" class="form-control" id="current-assets-2023" value="41500"></td>
                                        </tr>
                                        <tr>
                                            <td>固定资产</td>
                                            <td><input type="number" class="form-control" id="fixed-assets-2023" value="45000"></td>
                                        </tr>
                                        <tr>
                                            <td>资产总计</td>
                                            <td><input type="number" class="form-control" id="total-assets-2023" value="98500"></td>
                                        </tr>
                                        <tr>
                                            <td>流动负债合计</td>
                                            <td><input type="number" class="form-control" id="current-liabilities-2023" value="29500"></td>
                                        </tr>
                                        <tr>
                                            <td>非流动负债合计</td>
                                            <td><input type="number" class="form-control" id="non-current-liabilities-2023" value="19000"></td>
                                        </tr>
                                        <tr>
                                            <td>负债合计</td>
                                            <td><input type="number" class="form-control" id="total-liabilities-2023" value="48500"></td>
                                        </tr>
                                        <tr>
                                            <td>所有者权益合计</td>
                                            <td><input type="number" class="form-control" id="equity-2023" value="50000"></td>
                                        </tr>
                                    </table>
                                </div>
                                <div class="col-md-6">
                                    <h5>利润表</h5>
                                    <table class="table table-bordered form-table">
                                        <tr>
                                            <th>项目</th>
                                            <th>金额（万元）</th>
                                        </tr>
                                        <tr>
                                            <td>营业收入</td>
                                            <td><input type="number" class="form-control" id="revenue-2023" value="135000"></td>
                                        </tr>
                                        <tr>
                                            <td>营业成本</td>
                                            <td><input type="number" class="form-control" id="cost-2023" value="102000"></td>
                                        </tr>
                                        <tr>
                                            <td>营业利润</td>
                                            <td><input type="number" class="form-control" id="operating-profit-2023" value="19800"></td>
                                        </tr>
                                        <tr>
                                            <td>利润总额</td>
                                            <td><input type="number" class="form-control" id="total-profit-2023" value="19300"></td>
                                        </tr>
                                        <tr>
                                            <td>净利润</td>
                                            <td><input type="number" class="form-control" id="net-profit-2023" value="14500"></td>
                                        </tr>
                                        <tr>
                                            <td>利息费用</td>
                                            <td><input type="number" class="form-control" id="interest-2023" value="4700"></td>
                                        </tr>
                                        <tr>
                                            <td>折旧与摊销</td>
                                            <td><input type="number" class="form-control" id="depreciation-2023" value="8200"></td>
                                        </tr>
                                    </table>
                                    
                                    <h5 class="mt-4">现金流量表</h5>
                                    <table class="table table-bordered form-table">
                                        <tr>
                                            <th>项目</th>
                                            <th>金额（万元）</th>
                                        </tr>
                                        <tr>
                                            <td>经营活动现金流量净额</td>
                                            <td><input type="number" class="form-control" id="operating-cashflow-2023" value="17800"></td>
                                        </tr>
                                        <tr>
                                            <td>投资活动现金流量净额</td>
                                            <td><input type="number" class="form-control" id="investing-cashflow-2023" value="-13500"></td>
                                        </tr>
                                        <tr>
                                            <td>筹资活动现金流量净额</td>
                                            <td><input type="number" class="form-control" id="financing-cashflow-2023" value="-4200"></td>
                                        </tr>
                                        <tr>
                                            <td>资本支出</td>
                                            <td><input type="number" class="form-control" id="capital-expenditure-2023" value="12500"></td>
                                        </tr>
                                    </table>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 2024年数据 -->
                        <div class="tab-pane fade" id="year3">
                            <div class="row">
                                <div class="col-md-6">
                                    <h5>资产负债表</h5>
                                    <table class="table table-bordered form-table">
                                        <tr>
                                            <th>项目</th>
                                            <th>金额（万元）</th>
                                        </tr>
                                        <tr>
                                            <td>货币资金</td>
                                            <td><input type="number" class="form-control" id="cash-2024" value="18500"></td>
                                        </tr>
                                        <tr>
                                            <td>应收账款</td>
                                            <td><input type="number" class="form-control" id="receivables-2024" value="9800"></td>
                                        </tr>
                                        <tr>
                                            <td>存货</td>
                                            <td><input type="number" class="form-control" id="inventory-2024" value="14200"></td>
                                        </tr>
                                        <tr>
                                            <td>流动资产合计</td>
                                            <td><input type="number" class="form-control" id="current-assets-2024" value="44500"></td>
                                        </tr>
                                        <tr>
                                            <td>固定资产</td>
                                            <td><input type="number" class="form-control" id="fixed-assets-2024" value="48000"></td>
                                        </tr>
                                        <tr>
                                            <td>资产总计</td>
                                            <td><input type="number" class="form-control" id="total-assets-2024" value="105000"></td>
                                        </tr>
                                        <tr>
                                            <td>流动负债合计</td>
                                            <td><input type="number" class="form-control" id="current-liabilities-2024" value="30500"></td>
                                        </tr>
                                        <tr>
                                            <td>非流动负债合计</td>
                                            <td><input type="number" class="form-control" id="non-current-liabilities-2024" value="20000"></td>
                                        </tr>
                                        <tr>
                                            <td>负债合计</td>
                                            <td><input type="number" class="form-control" id="total-liabilities-2024" value="50500"></td>
                                        </tr>
                                        <tr>
                                            <td>所有者权益合计</td>
                                            <td><input type="number" class="form-control" id="equity-2024" value="54500"></td>
                                        </tr>
                                    </table>
                                </div>
                                <div class="col-md-6">
                                    <h5>利润表</h5>
                                    <table class="table table-bordered form-table">
                                        <tr>
                                            <th>项目</th>
                                            <th>金额（万元）</th>
                                        </tr>
                                        <tr>
                                            <td>营业收入</td>
                                            <td><input type="number" class="form-control" id="revenue-2024" value="145000"></td>
                                        </tr>
                                        <tr>
                                            <td>营业成本</td>
                                            <td><input type="number" class="form-control" id="cost-2024" value="110000"></td>
                                        </tr>
                                        <tr>
                                            <td>营业利润</td>
                                            <td><input type="number" class="form-control" id="operating-profit-2024" value="21000"></td>
                                        </tr>
                                        <tr>
                                            <td>利润总额</td>
                                            <td><input type="number" class="form-control" id="total-profit-2024" value="20500"></td>
                                        </tr>
                                        <tr>
                                            <td>净利润</td>
                                            <td><input type="number" class="form-control" id="net-profit-2024" value="15400"></td>
                                        </tr>
                                        <tr>
                                            <td>利息费用</td>
                                            <td><input type="number" class="form-control" id="interest-2024" value="4800"></td>
                                        </tr>
                                        <tr>
                                            <td>折旧与摊销</td>
                                            <td><input type="number" class="form-control" id="depreciation-2024" value="8500"></td>
                                        </tr>
                                    </table>
                                    
                                    <h5 class="mt-4">现金流量表</h5>
                                    <table class="table table-bordered form-table">
                                        <tr>
                                            <th>项目</th>
                                            <th>金额（万元）</th>
                                        </tr>
                                        <tr>
                                            <td>经营活动现金流量净额</td>
                                            <td><input type="number" class="form-control" id="operating-cashflow-2024" value="19200"></td>
                                        </tr>
                                        <tr>
                                            <td>投资活动现金流量净额</td>
                                            <td><input type="number" class="form-control" id="investing-cashflow-2024" value="-14500"></td>
                                        </tr>
                                        <tr>
                                            <td>筹资活动现金流量净额</td>
                                            <td><input type="number" class="form-control" id="financing-cashflow-2024" value="-4800"></td>
                                        </tr>
                                        <tr>
                                            <td>资本支出</td>
                                            <td><input type="number" class="form-control" id="capital-expenditure-2024" value="13500"></td>
                                        </tr>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="data-actions">
                        <button class="btn btn-primary me-2" id="save-data-btn"><i class="fas fa-save me-2"></i>保存并计算</button>
                        <button class="btn btn-outline-primary me-2"><i class="fas fa-file-import me-2"></i>导入Excel</button>
                        <button class="btn btn-outline-primary"><i class="fas fa-file-export me-2"></i>导出Excel</button>
                    </div>
                </div>
            </div>
            
            <!-- 财务指标计算模块 -->
            <div class="tab-pane fade" id="indicators" role="tabpanel">
                <div class="form-section">
                    <h3 class="form-title"><i class="fas fa-calculator"></i>财务指标计算结果</h3>
                    <p class="text-muted">以下是根据财务报表数据计算的近三年财务指标，按类别分组显示。</p>
                    
                    <div class="financial-summary">
                        <div class="summary-card">
                            <h5>应收账款周转率</h5>
                            <div class="value" id="receivables-turnover-summary">14.80</div>
                            <div class="trend trend-up" id="receivables-turnover-trend-summary">良好 <i class="fas fa-arrow-up"></i></div>
                        </div>
                        <div class="summary-card">
                            <h5>资产负债率</h5>
                            <div class="value" id="debt-ratio">50.0%</div>
                            <div class="trend trend-down" id="debt-trend">较去年下降1.5% <i class="fas fa-arrow-down"></i></div>
                        </div>
                        <div class="summary-card">
                            <h5>净资产收益率</h5>
                            <div class="value" id="roe">28.7%</div>
                            <div class="trend trend-up" id="roe-trend">行业领先 <i class="fas fa-arrow-up"></i></div>
                        </div>
                        <div class="summary-card">
                            <h5>自由现金流比率</h5>
                            <div class="value" id="free-cashflow-ratio">4.4%</div>
                            <div class="trend trend-down" id="cashflow-trend">需关注 <i class="fas fa-exclamation-triangle"></i></div>
                        </div>
                    </div>
                    
                    <div class="indicator-grid">
                        <!-- 偿债能力 -->
                        <div class="indicator-card">
                            <h5 class="text-primary"><i class="fas fa-shield-alt me-2"></i>偿债能力</h5>
                            <table class="indicator-table">
                                <thead>
                                    <tr>
                                        <th>指标</th>
                                        <th>2022</th>
                                        <th>2023</th>
                                        <th>2024</th>
                                        <th>趋势</th>
                                        <th>状态</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>流动比率</td>
                                        <td id="current-ratio-2022">1.36</td>
                                        <td id="current-ratio-2023">1.41</td>
                                        <td id="current-ratio-2024">1.46</td>
                                        <td id="current-ratio-trend"><span class="trend-up">↑3.55% <i class="fas fa-arrow-up trend-icon"></i></span></td>
                                        <td class="status-cell"><span id="current-ratio-status"><span class="status-badge status-good">良好</span></span></td>
                                    </tr>
                                    <tr>
                                        <td>速动比率</td>
                                        <td id="quick-ratio-2022">0.93</td>
                                        <td id="quick-ratio-2023">0.95</td>
                                        <td id="quick-ratio-2024">0.99</td>
                                        <td id="quick-ratio-trend"><span class="trend-up">↑4.21% <i class="fas fa-arrow-up trend-icon"></i></span></td>
                                        <td class="status-cell"><span id="quick-ratio-status"><span class="status-badge status-warning">一般</span></span></td>
                                    </tr>
                                    <tr>
                                        <td>现金比率</td>
                                        <td id="cash-ratio-2022">0.54</td>
                                        <td id="cash-ratio-2023">0.57</td>
                                        <td id="cash-ratio-2024">0.61</td>
                                        <td id="cash-ratio-trend"><span class="trend-up">↑7.02% <i class="fas fa-arrow-up trend-icon"></i></span></td>
                                        <td class="status-cell"><span id="cash-ratio-status"><span class="status-badge status-good">良好</span></span></td>
                                    </tr>
                                    <tr>
                                        <td>资产负债率</td>
                                        <td id="debt-ratio-2022">50.0%</td>
                                        <td id="debt-ratio-2023">49.2%</td>
                                        <td id="debt-ratio-2024">48.1%</td>
                                        <td id="debt-ratio-trend"><span class="trend-down">↓2.24% <i class="fas fa-arrow-down trend-icon"></i></span></td>
                                        <td class="status-cell"><span id="debt-ratio-status"><span class="status-badge status-good">优秀</span></span></td>
                                    </tr>
                                    <tr>
                                        <td>利息保障倍数</td>
                                        <td id="interest-coverage-2022">4.89</td>
                                        <td id="interest-coverage-2023">5.11</td>
                                        <td id="interest-coverage-2024">5.27</td>
                                        <td id="interest-coverage-trend"><span class="trend-up">↑3.13% <i class="fas fa-arrow-up trend-icon"></i></span></td>
                                        <td class="status-cell"><span id="interest-coverage-status"><span class="status-badge status-good">优秀</span></span></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- 盈利能力 -->
                        <div class="indicator-card">
                            <h5 class="text-primary"><i class="fas fa-chart-line me-2"></i>盈利能力</h5>
                            <table class="indicator-table">
                                <thead>
                                    <tr>
                                        <th>指标</th>
                                        <th>2022</th>
                                        <th>2023</th>
                                        <th>2024</th>
                                        <th>趋势</th>
                                        <th>状态</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>毛利率</td>
                                        <td id="gross-margin-2022">24.0%</td>
                                        <td id="gross-margin-2023">24.4%</td>
                                        <td id="gross-margin-2024">24.1%</td>
                                        <td id="gross-margin-trend"><span class="trend-down">↓1.23% <i class="fas fa-arrow-down trend-icon"></i></span></td>
                                        <td class="status-cell"><span id="gross-margin-status"><span class="status-badge status-good">良好</span></span></td>
                                    </tr>
                                    <tr>
                                        <td>营业利润率</td>
                                        <td id="operating-margin-2022">14.4%</td>
                                        <td id="operating-margin-2023">14.7%</td>
                                        <td id="operating-margin-2024">14.5%</td>
                                        <td id="operating-margin-trend"><span class="trend-down">↓1.36% <i class="fas fa-arrow-down trend-icon"></i></span></td>
                                        <td class="status-cell"><span id="operating-margin-status"><span class="status-badge status-good">良好</span></span></td>
                                    </tr>
                                    <tr>
                                        <td>净利率</td>
                                        <td id="net-margin-2022">10.6%</td>
                                        <td id="net-margin-2023">10.7%</td>
                                        <td id="net-margin-2024">10.6%</td>
                                        <td id="net-margin-trend"><span class="trend-down">↓0.93% <i class="fas fa-arrow-down trend-icon"></i></span></td>
                                        <td class="status-cell"><span id="net-margin-status"><span class="status-badge status-good">良好</span></span></td>
                                    </tr>
                                    <tr>
                                        <td>总资产报酬率</td>
                                        <td id="roa-2022">14.3%</td>
                                        <td id="roa-2023">14.7%</td>
                                        <td id="roa-2024">14.7%</td>
                                        <td id="roa-trend"><span class="trend-up">→ 0.00%</span></td>
                                        <td class="status-cell"><span id="roa-status"><span class="status-badge status-good">良好</span></span></td>
                                    </tr>
                                    <tr>
                                        <td>净资产收益率</td>
                                        <td id="roe-2022">28.7%</td>
                                        <td id="roe-2023">29.0%</td>
                                        <td id="roe-2024">28.3%</td>
                                        <td id="roe-trend"><span class="trend-down">↓2.41% <i class="fas fa-arrow-down trend-icon"></i></span></td>
                                        <td class="status-cell"><span id="roe-status"><span class="status-badge status-good">优秀</span></span></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- 营运能力 -->
                        <div class="indicator-card">
                            <h5 class="text-primary"><i class="fas fa-tachometer-alt me-2"></i>营运能力</h5>
                            <table class="indicator-table">
                                <thead>
                                    <tr>
                                        <th>指标</th>
                                        <th>2022</th>
                                        <th>2023</th>
                                        <th>2024</th>
                                        <th>趋势</th>
                                        <th>状态</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>应收账款周转率</td>
                                        <td id="receivables-turnover-2022">14.71</td>
                                        <td id="receivables-turnover-2023">14.67</td>
                                        <td id="receivables-turnover-2024">14.80</td>
                                        <td id="receivables-turnover-trend"><span class="trend-up">↑0.89% <i class="fas fa-arrow-up trend-icon"></i></span></td>
                                        <td class="status-cell"><span id="receivables-turnover-status"><span class="status-badge status-good">良好</span></span></td>
                                    </tr>
                                    <tr>
                                        <td>存货周转率</td>
                                        <td id="inventory-turnover-2022">7.92</td>
                                        <td id="inventory-turnover-2023">7.56</td>
                                        <td id="inventory-turnover-2024">7.75</td>
                                        <td id="inventory-turnover-trend"><span class="trend-up">↑2.51% <i class="fas fa-arrow-up trend-icon"></i></span></td>
                                        <td class="status-cell"><span id="inventory-turnover-status"><span class="status-badge status-good">良好</span></span></td>
                                    </tr>
                                    <tr>
                                        <td>总资产周转率</td>
                                        <td id="asset-turnover-2022">1.36</td>
                                        <td id="asset-turnover-2023">1.37</td>
                                        <td id="asset-turnover-2024">1.38</td>
                                        <td id="asset-turnover-trend"><span class="trend-up">↑0.73% <i class="fas fa-arrow-up trend-icon"></i></span></td>
                                        <td class="status-cell"><span id="asset-turnover-status"><span class="status-badge status-good">良好</span></span></td>
                                    </tr>
                                    <tr>
                                        <td>固定资产周转率</td>
                                        <td id="fixed-asset-turnover-2022">2.98</td>
                                        <td id="fixed-asset-turnover-2023">3.00</td>
                                        <td id="fixed-asset-turnover-2024">3.02</td>
                                        <td id="fixed-asset-turnover-trend"><span class="trend-up">↑0.67% <i class="fas fa-arrow-up trend-icon"></i></span></td>
                                        <td class="status-cell"><span id="fixed-asset-turnover-status"><span class="status-badge status-good">良好</span></span></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- 发展能力 -->
                        <div class="indicator-card">
                            <h5 class="text-primary"><i class="fas fa-seedling me-2"></i>发展能力</h5>
                            <table class="indicator-table">
                                <thead>
                                    <tr>
                                        <th>指标</th>
                                        <th>2022</th>
                                        <th>2023</th>
                                        <th>2024</th>
                                        <th>趋势</th>
                                        <th>状态</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>营业收入增长率</td>
                                        <td id="revenue-growth-2022">--</td>
                                        <td id="revenue-growth-2023">8.0%</td>
                                        <td id="revenue-growth-2024">7.4%</td>
                                        <td id="revenue-growth-trend"><span class="trend-down">↓7.50% <i class="fas fa-arrow-down trend-icon"></i></span></td>
                                        <td class="status-cell"><span id="revenue-growth-status"><span class="status-badge status-warning">一般</span></span></td>
                                    </tr>
                                    <tr>
                                        <td>净利润增长率</td>
                                        <td id="profit-growth-2022">--</td>
                                        <td id="profit-growth-2023">9.8%</td>
                                        <td id="profit-growth-2024">6.2%</td>
                                        <td id="profit-growth-trend"><span class="trend-down">↓36.73% <i class="fas fa-arrow-down trend-icon"></i></span></td>
                                        <td class="status-cell"><span id="profit-growth-status"><span class="status-badge status-warning">一般</span></span></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- 现金流量 -->
                        <div class="indicator-card">
                            <h5 class="text-primary"><i class="fas fa-money-bill-wave me-2"></i>现金流量</h5>
                            <table class="indicator-table">
                                <thead>
                                    <tr>
                                        <th>指标</th>
                                        <th>2022</th>
                                        <th>2023</th>
                                        <th>2024</th>
                                        <th>趋势</th>
                                        <th>状态</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>现金流动负债比率</td>
                                        <td id="cash-flow-liability-2022">58.9%</td>
                                        <td id="cash-flow-liability-2023">60.3%</td>
                                        <td id="cash-flow-liability-2024">63.0%</td>
                                        <td id="cash-flow-liability-trend"><span class="trend-up">↑4.48% <i class="fas fa-arrow-up trend-icon"></i></span></td>
                                        <td class="status-cell"><span id="cash-flow-liability-status"><span class="status-badge status-good">优秀</span></span></td>
                                    </tr>
                                    <tr>
                                        <td>现金流量比率</td>
                                        <td id="cash-flow-ratio-2022">0.59</td>
                                        <td id="cash-flow-ratio-2023">0.60</td>
                                        <td id="cash-flow-ratio-2024">0.63</td>
                                        <td id="cash-flow-ratio-trend"><span class="trend-up">↑5.00% <i class="fas fa-arrow-up trend-icon"></i></span></td>
                                        <td class="status-cell"><span id="cash-flow-ratio-status"><span class="status-badge status-good">优秀</span></span></td>
                                    </tr>
                                    <tr>
                                        <td>自由现金流比率</td>
                                        <td id="free-cashflow-ratio-2022">4.4%</td>
                                        <td id="free-cashflow-ratio-2023">3.9%</td>
                                        <td id="free-cashflow-ratio-2024">3.9%</td>
                                        <td id="free-cashflow-ratio-trend"><span class="trend-down">↓0.00% <i class="fas fa-arrow-down trend-icon"></i></span></td>
                                        <td class="status-cell"><span id="free-cashflow-ratio-status"><span class="status-badge status-warning">一般</span></span></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <div class="mt-4 text-center">
                        <button class="btn btn-export me-2" id="export-indicators"><i class="fas fa-download me-2"></i>导出指标报告</button>
                    </div>
                </div>
            </div>
            
            <!-- 数据图表模块 -->
            <div class="tab-pane fade" id="charts" role="tabpanel">
                <div class="form-section">
                    <h3 class="form-title"><i class="fas fa-chart-line"></i>财务指标趋势分析</h3>
                    <p class="text-muted">近三年关键财务指标变化趋势可视化分析。</p>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="chart-container">
                                <h5 class="text-center mb-4">偿债能力指标趋势</h5>
                                <canvas id="solvencyChart"></canvas>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="chart-container">
                                <h5 class="text-center mb-4">盈利能力指标趋势</h5>
                                <canvas id="profitabilityChart"></canvas>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="chart-container">
                                <h5 class="text-center mb-4">营运能力指标趋势</h5>
                                <canvas id="operationChart"></canvas>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="chart-container">
                                <h5 class="text-center mb-4">发展能力指标趋势</h5>
                                <canvas id="growthChart"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-4 text-center">
                        <button class="btn btn-export me-2" id="export-charts"><i class="fas fa-download me-2"></i>导出图表报告</button>
                    </div>
                </div>
            </div>
            
            <!-- 财务分析模块 -->
            <div class="tab-pane fade" id="analysis" role="tabpanel">
                <div class="form-section">
                    <h3 class="form-title"><i class="fas fa-file-alt"></i>综合财务分析报告</h3>
                    <p class="text-muted">基于近三年财务数据的综合分析及评估建议。</p>
                    
                    <div class="analysis-card">
                        <h5><i class="fas fa-shield-alt section-icon"></i>偿债能力分析</h5>
                        <p id="solvency-analysis">该企业2024年流动比率为1.46，高于行业平均水平(1.8)，短期偿债能力良好。速动比率0.99接近安全水平(1)，资产负债率48.1%处于合理范围，利息保障倍数5.27表现良好，长期偿债能力稳定。</p>
                    </div>
                    
                    <div class="analysis-card">
                        <h5><i class="fas fa-chart-line section-icon"></i>盈利能力分析</h5>
                        <p id="profitability-analysis">近三年毛利率稳定在24%左右，高于行业平均(18%)，成本控制良好。净利率保持在10.6%左右，净资产收益率28.3%表现优异，显示较强的盈利能力。总资产报酬率14.7%高于行业平均(12%)，资产利用效率较高。</p>
                    </div>
                    
                    <div class="analysis-card">
                        <h5><i class="fas fa-tachometer-alt section-icon"></i>营运能力分析</h5>
                        <p id="operation-analysis">应收账款周转率14.80次，高于行业平均(10.5次)，收款效率良好。存货周转率7.75次，固定资产周转率3.02次，均高于行业平均水平，显示良好的资产管理能力。总资产周转率1.38次，资产使用效率较高。</p>
                    </div>
                    
                    <div class="analysis-card">
                        <h5><i class="fas fa-seedling section-icon"></i>发展能力分析</h5>
                        <p id="growth-analysis">2024年营业收入增长率为7.4%，略低于行业平均(9.5%)。净利润增长率6.2%，低于营业收入增速，需关注盈利能力提升。自由现金流比率3.9%，需关注投资扩张带来的现金流压力。</p>
                    </div>
                    
                    <!-- 综合评估面板 -->
                    <div class="assessment-panel">
                        <div class="assessment-header">
                            <div class="assessment-icon">
                                <i class="fas fa-star"></i>
                            </div>
                            <div>
                                <h4>综合评估</h4>
                                <p>基于多维度的财务指标分析</p>
                            </div>
                        </div>
                        <div class="assessment-content" id="overall-assessment">
                            该企业整体财务状况良好，盈利能力突出，资产使用效率较高。主要风险点在于发展能力偏弱，需关注成长性提升。
                        </div>
                        <div class="mt-3">
                            <strong>评级：</strong> <span class="badge bg-success fs-6" id="rating-badge">A- (良好)</span>
                        </div>
                    </div>
                    
                    <div class="mt-4 text-center">
                        <button class="btn btn-export me-2" id="export-analysis"><i class="fas fa-download me-2"></i>导出分析报告</button>
                    </div>
                </div>
            </div>
            
            <!-- 沃尔评分体系模块 -->
            <div class="tab-pane fade" id="scoring" role="tabpanel">
                <div class="form-section">
                    <h3 class="form-title"><i class="fas fa-star"></i>沃尔评分体系评估</h3>
                    <p class="text-muted">基于建筑行业特点的沃尔评分法综合评估。</p>
                    
                    <div class="row">
                        <div class="col-md-8">
                            <table class="table table-striped table-hover walt-scoring-table">
                                <thead>
                                    <tr class="table-primary">
                                        <th>评价指标</th>
                                        <th>权重(%)</th>
                                        <th>标准值</th>
                                        <th>实际值</th>
                                        <th>评分</th>
                                        <th>状态</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>流动比率</td>
                                        <td>10</td>
                                        <td>1.8</td>
                                        <td id="walt-current-ratio">1.46</td>
                                        <td id="walt-current-ratio-score">6.49</td>
                                        <td class="status-cell"><span id="walt-current-ratio-status"><span class="status-badge status-warning">一般</span></span></td>
                                    </tr>
                                    <tr>
                                        <td>资产负债率</td>
                                        <td>10</td>
                                        <td>60%</td>
                                        <td id="walt-debt-ratio">48.1%</td>
                                        <td id="walt-debt-ratio-score">11.43</td>
                                        <td class="status-cell"><span id="walt-debt-ratio-status"><span class="status-badge status-good">良好</span></span></td>
                                    </tr>
                                    <tr>
                                        <td>净资产收益率</td>
                                        <td>15</td>
                                        <td>15%</td>
                                        <td id="walt-roe">28.3%</td>
                                        <td id="walt-roe-score">28.30</td>
                                        <td class="status-cell"><span id="walt-roe-status"><span class="status-badge status-good">优秀</span></span></td>
                                    </tr>
                                    <tr>
                                        <td>总资产周转率</td>
                                        <td>10</td>
                                        <td>1.0</td>
                                        <td id="walt-asset-turnover">1.38</td>
                                        <td id="walt-asset-turnover-score">13.80</td>
                                        <td class="status-cell"><span id="walt-asset-turnover-status"><span class="status-badge status-good">优秀</span></span></td>
                                    </tr>
                                    <tr>
                                        <td>营业收入增长率</td>
                                        <td>8</td>
                                        <td>7%</td>
                                        <td id="walt-revenue-growth">7.4%</td>
                                        <td id="walt-revenue-growth-score">7.40</td>
                                        <td class="status-cell"><span id="walt-revenue-growth-status"><span class="status-badge status-warning">一般</span></span></td>
                                    </tr>
                                    <tr>
                                        <td>净利润增长率</td>
                                        <td>9</td>
                                        <td>9%</td>
                                        <td id="walt-profit-growth">6.2%</td>
                                        <td id="walt-profit-growth-score">5.17</td>
                                        <td class="status-cell"><span id="walt-profit-growth-status"><span class="status-badge status-warning">一般</span></span></td>
                                    </tr>
                                    <tr>
                                        <td>利息保障倍数</td>
                                        <td>8</td>
                                        <td>4.0</td>
                                        <td id="walt-interest-coverage">5.27</td>
                                        <td id="walt-interest-coverage-score">10.54</td>
                                        <td class="status-cell"><span id="walt-interest-coverage-status"><span class="status-badge status-good">良好</span></span></td>
                                    </tr>
                                    <tr>
                                        <td>现金流动负债比率</td>
                                        <td>10</td>
                                        <td>45%</td>
                                        <td id="walt-cash-flow-liability">63.0%</td>
                                        <td id="walt-cash-flow-liability-score">12.60</td>
                                        <td class="status-cell"><span id="walt-cash-flow-liability-status"><span class="status-badge status-good">良好</span></span></td>
                                    </tr>
                                    <tr>
                                        <td>毛利率</td>
                                        <td>9</td>
                                        <td>20%</td>
                                        <td id="walt-gross-margin">24.1%</td>
                                        <td id="walt-gross-margin-score">10.71</td>
                                        <td class="status-cell"><span id="walt-gross-margin-status"><span class="status-badge status-good">优秀</span></span></td>
                                    </tr>
                                    <tr>
                                        <td>自由现金流比率</td>
                                        <td>11</td>
                                        <td>6%</td>
                                        <td id="walt-free-cashflow-ratio">3.9%</td>
                                        <td id="walt-free-cashflow-ratio-score">7.15</td>
                                        <td class="status-cell"><span id="walt-free-cashflow-ratio-status"><span class="status-badge status-warning">一般</span></span></td>
                                    </tr>
                                </tbody>
                                <tfoot class="table-secondary">
                                    <tr>
                                        <th>综合得分</th>
                                        <th>100</th>
                                        <th></th>
                                        <th></th>
                                        <th id="walt-total-score">114.59</th>
                                        <th><span class="status-badge status-good" id="walt-total-status">优秀</span></th>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                        <div class="col-md-4">
                            <div class="score-card">
                                <h4 class="text-center">沃尔评分结果</h4>
                                <h1 class="text-center display-3" id="walt-score-value">114.59</h1>
                                <div class="text-center mb-3">
                                    <span class="badge bg-success fs-5 p-2" id="walt-score-badge">优秀</span>
                                </div>
                                <p class="mb-2">评分等级：</p>
                                <div class="progress mb-2" style="height: 20px;">
                                    <div class="progress-bar bg-success" role="progressbar" style="width: 100%">>100分：优秀</div>
                                </div>
                                <div class="progress mb-2" style="height: 20px;">
                                    <div class="progress-bar bg-info" role="progressbar" style="width: 80%">90-100分：良好</div>
                                </div>
                                <div class="progress mb-2" style="height: 20px;">
                                    <div class="progress-bar bg-warning" role="progressbar" style="width: 70%">80-90分：一般</div>
                                </div>
                                <div class="progress mb-3" style="height: 20px;">
                                    <div class="progress-bar bg-danger" role="progressbar" style="width: 60%"><80分：较差</div>
                                </div>
                                <p class="mb-0" id="walt-evaluation"><strong>评估说明：</strong>该企业综合评分114.59分，高于基准分100分，财务综合状况优秀。主要优势在于盈利能力和资产周转效率，主要弱项是短期偿债能力和自由现金流比率。</p>
                            </div>
                            
                            <div class="mt-4">
                                <h5>行业对比</h5>
                                <canvas id="industryChart"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-4 text-center">
                        <button class="btn btn-export me-2" id="export-scoring"><i class="fas fa-download me-2"></i>导出评分报告</button>
                    </div>
                </div>
            </div>
            
            <!-- 杜邦分析模块 -->
            <div class="tab-pane fade" id="dupont" role="tabpanel">
                <div class="form-section">
                    <h3 class="form-title"><i class="fas fa-sitemap"></i>杜邦分析体系</h3>
                    <p class="text-muted">净资产收益率(ROE)的分解分析。</p>
                    
                    <div class="du-pont-chart">
                        <div class="text-center mb-4">
                            <h3>净资产收益率(ROE) = <span id="dupont-roe">28.3%</span></h3>
                        </div>
                        
                        <div class="row text-center">
                            <div class="col-md-4">
                                <div class="p-3 border rounded bg-light">
                                    <h5>净利率</h5>
                                    <h3 class="text-primary" id="dupont-net-margin">10.6%</h3>
                                    <div class="mt-3">
                                        <canvas id="profitMarginChart" height="200"></canvas>
                                    </div>
                                    <p class="mt-2">净利润/营业收入</p>
                                </div>
                            </div>
                            <div class="col-md-4 align-self-center">
                                <h1>×</h1>
                            </div>
                            <div class="col-md-4">
                                <div class="p-3 border rounded bg-light">
                                    <h5>总资产周转率</h5>
                                    <h3 class="text-primary" id="dupont-asset-turnover">1.38</h3>
                                    <div class="mt-3">
                                        <canvas id="assetTurnoverChart" height="200"></canvas>
                                    </div>
                                    <p class="mt-2">营业收入/总资产</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row mt-4 text-center">
                            <div class="col-md-12">
                                <h1>=</h1>
                            </div>
                        </div>
                        
                        <div class="row text-center">
                            <div class="col-md-4 offset-md-4">
                                <div class="p-3 border rounded bg-light">
                                    <h5>权益乘数</h5>
                                    <h3 class="text-primary" id="dupont-equity-multiplier">1.93</h3>
                                    <div class="mt-3">
                                        <canvas id="equityMultiplierChart" height="200"></canvas>
                                    </div>
                                    <p class="mt-2">总资产/所有者权益</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="analysis-card mt-4">
                        <h5><i class="fas fa-chart-pie section-icon"></i>杜邦分析结论</h5>
                        <p id="dupont-analysis">该企业2024年净资产收益率(ROE)为28.3%，表现优异。从杜邦分析体系分解来看：</p>
                        <ul>
                            <li><strong>净利率(10.6%)</strong>：高于行业平均(8.2%)，显示良好的盈利能力</li>
                            <li><strong>总资产周转率(1.38次)</strong>：高于行业平均(1.05次)，资产使用效率高</li>
                            <li><strong>权益乘数(1.93)</strong>：处于合理范围，财务杠杆运用适度</li>
                        </ul>
                    </div>
                    
                    <div class="mt-4 text-center">
                        <button class="btn btn-export me-2" id="export-dupont"><i class="fas fa-download me-2"></i>导出杜邦分析报告</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="footer">
        <div class="container">
            <p>埃维集团财务中心 &copy; 2025 | 洲际酒店改造项目投标单位财务分析系统</p>
            <p class="mb-0">版本：v5.3.1 | 最后更新：2025-07-22 | 技术支持：出纳考核部</p>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // 财务数据结构
        const financialData = {
            company: '中建三局集团有限公司',
            years: [2022, 2023, 2024],
            balanceSheets: {},
            incomeStatements: {},
            cashFlowStatements: {}
        };
        
        // 财务指标计算结果
        const financialIndicators = {
            solvency: {},
            profitability: {},
            operation: {},
            growth: {},
            cashflow: {}
        };
        
        // 图表对象
        let solvencyChart, profitabilityChart, operationChart, growthChart, industryChart;
        let profitMarginChart, assetTurnoverChart, equityMultiplierChart;
        
        // 初始化页面时加载默认数据
        document.addEventListener('DOMContentLoaded', function() {
            // 从输入框读取初始数据
            collectFinancialData();
            // 计算财务指标
            calculateFinancialIndicators();
            // 更新页面显示
            updateFinancialIndicatorsDisplay();
            // 初始化图表
            initializeCharts();
            
            // 添加事件监听器
            document.getElementById('save-data-btn').addEventListener('click', saveAndCalculate);
            
            // 导出按钮事件
            document.getElementById('export-indicators').addEventListener('click', function() {
                exportReport('indicators');
            });
            document.getElementById('export-charts').addEventListener('click', function() {
                exportReport('charts');
            });
            document.getElementById('export-analysis').addEventListener('click', function() {
                exportReport('analysis');
            });
            document.getElementById('export-scoring').addEventListener('click', function() {
                exportReport('scoring');
            });
            document.getElementById('export-dupont').addEventListener('click', function() {
                exportReport('dupont');
            });
            
            // 单位切换
            document.querySelectorAll('.unit-toggle .btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelector('.unit-toggle .btn.active').classList.remove('active');
                    this.classList.add('active');
                    const unit = this.dataset.unit;
                    updateUnitDisplay(unit);
                });
            });
        });
        
        // 收集财务数据
        function collectFinancialData() {
            // 收集2022年数据
            financialData.balanceSheets[2022] = {
                cash: parseFloat(document.getElementById('cash-2022').value) || 0,
                receivables: parseFloat(document.getElementById('receivables-2022').value) || 0,
                inventory: parseFloat(document.getElementById('inventory-2022').value) || 0,
                currentAssets: parseFloat(document.getElementById('current-assets-2022').value) || 0,
                fixedAssets: parseFloat(document.getElementById('fixed-assets-2022').value) || 0,
                totalAssets: parseFloat(document.getElementById('total-assets-2022').value) || 0,
                currentLiabilities: parseFloat(document.getElementById('current-liabilities-2022').value) || 0,
                nonCurrentLiabilities: parseFloat(document.getElementById('non-current-liabilities-2022').value) || 0,
                totalLiabilities: parseFloat(document.getElementById('total-liabilities-2022').value) || 0,
                equity: parseFloat(document.getElementById('equity-2022').value) || 0
            };
            
            financialData.incomeStatements[2022] = {
                revenue: parseFloat(document.getElementById('revenue-2022').value) || 0,
                cost: parseFloat(document.getElementById('cost-2022').value) || 0,
                operatingProfit: parseFloat(document.getElementById('operating-profit-2022').value) || 0,
                totalProfit: parseFloat(document.getElementById('total-profit-2022').value) || 0,
                netProfit: parseFloat(document.getElementById('net-profit-2022').value) || 0,
                interest: parseFloat(document.getElementById('interest-2022').value) || 0,
                depreciation: parseFloat(document.getElementById('depreciation-2022').value) || 0
            };
            
            financialData.cashFlowStatements[2022] = {
                operatingCashflow: parseFloat(document.getElementById('operating-cashflow-2022').value) || 0,
                investingCashflow: parseFloat(document.getElementById('investing-cashflow-2022').value) || 0,
                financingCashflow: parseFloat(document.getElementById('financing-cashflow-2022').value) || 0,
                capitalExpenditure: parseFloat(document.getElementById('capital-expenditure-2022').value) || 0
            };
            
            // 收集2023年数据
            financialData.balanceSheets[2023] = {
                cash: parseFloat(document.getElementById('cash-2023').value) || 0,
                receivables: parseFloat(document.getElementById('receivables-2023').value) || 0,
                inventory: parseFloat(document.getElementById('inventory-2023').value) || 0,
                currentAssets: parseFloat(document.getElementById('current-assets-2023').value) || 0,
                fixedAssets: parseFloat(document.getElementById('fixed-assets-2023').value) || 0,
                totalAssets: parseFloat(document.getElementById('total-assets-2023').value) || 0,
                currentLiabilities: parseFloat(document.getElementById('current-liabilities-2023').value) || 0,
                nonCurrentLiabilities: parseFloat(document.getElementById('non-current-liabilities-2023').value) || 0,
                totalLiabilities: parseFloat(document.getElementById('total-liabilities-2023').value) || 0,
                equity: parseFloat(document.getElementById('equity-2023').value) || 0
            };
            
            financialData.incomeStatements[2023] = {
                revenue: parseFloat(document.getElementById('revenue-2023').value) || 0,
                cost: parseFloat(document.getElementById('cost-2023').value) || 0,
                operatingProfit: parseFloat(document.getElementById('operating-profit-2023').value) || 0,
                totalProfit: parseFloat(document.getElementById('total-profit-2023').value) || 0,
                netProfit: parseFloat(document.getElementById('net-profit-2023').value) || 0,
                interest: parseFloat(document.getElementById('interest-2023').value) || 0,
                depreciation: parseFloat(document.getElementById('depreciation-2023').value) || 0
            };
            
            financialData.cashFlowStatements[2023] = {
                operatingCashflow: parseFloat(document.getElementById('operating-cashflow-2023').value) || 0,
                investingCashflow: parseFloat(document.getElementById('investing-cashflow-2023').value) || 0,
                financingCashflow: parseFloat(document.getElementById('financing-cashflow-2023').value) || 0,
                capitalExpenditure: parseFloat(document.getElementById('capital-expenditure-2023').value) || 0
            };
            
            // 收集2024年数据
            financialData.balanceSheets[2024] = {
                cash: parseFloat(document.getElementById('cash-2024').value) || 0,
                receivables: parseFloat(document.getElementById('receivables-2024').value) || 0,
                inventory: parseFloat(document.getElementById('inventory-2024').value) || 0,
                currentAssets: parseFloat(document.getElementById('current-assets-2024').value) || 0,
                fixedAssets: parseFloat(document.getElementById('fixed-assets-2024').value) || 0,
                totalAssets: parseFloat(document.getElementById('total-assets-2024').value) || 0,
                currentLiabilities: parseFloat(document.getElementById('current-liabilities-2024').value) || 0,
                nonCurrentLiabilities: parseFloat(document.getElementById('non-current-liabilities-2024').value) || 0,
                totalLiabilities: parseFloat(document.getElementById('total-liabilities-2024').value) || 0,
                equity: parseFloat(document.getElementById('equity-2024').value) || 0
            };
            
            financialData.incomeStatements[2024] = {
                revenue: parseFloat(document.getElementById('revenue-2024').value) || 0,
                cost: parseFloat(document.getElementById('cost-2024').value) || 0,
                operatingProfit: parseFloat(document.getElementById('operating-profit-2024').value) || 0,
                totalProfit: parseFloat(document.getElementById('total-profit-2024').value) || 0,
                netProfit: parseFloat(document.getElementById('net-profit-2024').value) || 0,
                interest: parseFloat(document.getElementById('interest-2024').value) || 0,
                depreciation: parseFloat(document.getElementById('depreciation-2024').value) || 0
            };
            
            financialData.cashFlowStatements[2024] = {
                operatingCashflow: parseFloat(document.getElementById('operating-cashflow-2024').value) || 0,
                investingCashflow: parseFloat(document.getElementById('investing-cashflow-2024').value) || 0,
                financingCashflow: parseFloat(document.getElementById('financing-cashflow-2024').value) || 0,
                capitalExpenditure: parseFloat(document.getElementById('capital-expenditure-2024').value) || 0
            };
        }
        
        // 计算财务指标
        function calculateFinancialIndicators() {
            // 计算偿债能力指标
            financialIndicators.solvency = {};
            financialData.years.forEach(year => {
                const bs = financialData.balanceSheets[year];
                const is = financialData.incomeStatements[year];
                
                // 流动比率 = 流动资产 / 流动负债
                const currentRatio = bs.currentLiabilities ? bs.currentAssets / bs.currentLiabilities : 0;
                
                // 速动比率 = (流动资产 - 存货) / 流动负债
                const quickRatio = bs.currentLiabilities ? (bs.currentAssets - bs.inventory) / bs.currentLiabilities : 0;
                
                // 现金比率 = 货币资金 / 流动负债
                const cashRatio = bs.currentLiabilities ? bs.cash / bs.currentLiabilities : 0;
                
                // 资产负债率 = 负债总额 / 资产总额
                const debtRatio = bs.totalAssets ? bs.totalLiabilities / bs.totalAssets : 0;
                
                // 利息保障倍数 = (利润总额 + 利息费用) / 利息费用
                const interestCoverage = is.interest ? (is.totalProfit + is.interest) / is.interest : 0;
                
                financialIndicators.solvency[year] = {
                    currentRatio: parseFloat(currentRatio.toFixed(2)),
                    quickRatio: parseFloat(quickRatio.toFixed(2)),
                    cashRatio: parseFloat(cashRatio.toFixed(2)),
                    debtRatio: parseFloat((debtRatio * 100).toFixed(1)),
                    interestCoverage: parseFloat(interestCoverage.toFixed(2))
                };
            });
            
            // 计算盈利能力指标
            financialIndicators.profitability = {};
            financialData.years.forEach(year => {
                const bs = financialData.balanceSheets[year];
                const is = financialData.incomeStatements[year];
                
                // 毛利率 = (营业收入 - 营业成本) / 营业收入
                const grossMargin = is.revenue ? (is.revenue - is.cost) / is.revenue : 0;
                
                // 营业利润率 = 营业利润 / 营业收入
                const operatingMargin = is.revenue ? is.operatingProfit / is.revenue : 0;
                
                // 净利率 = 净利润 / 营业收入
                const netMargin = is.revenue ? is.netProfit / is.revenue : 0;
                
                // 总资产报酬率 = 净利润 / 总资产
                const roa = bs.totalAssets ? is.netProfit / bs.totalAssets : 0;
                
                // 净资产收益率 = 净利润 / 所有者权益
                const roe = bs.equity ? is.netProfit / bs.equity : 0;
                
                financialIndicators.profitability[year] = {
                    grossMargin: parseFloat((grossMargin * 100).toFixed(1)),
                    operatingMargin: parseFloat((operatingMargin * 100).toFixed(1)),
                    netMargin: parseFloat((netMargin * 100).toFixed(1)),
                    roa: parseFloat((roa * 100).toFixed(1)),
                    roe: parseFloat((roe * 100).toFixed(1))
                };
            });
            
            // 计算营运能力指标
            financialIndicators.operation = {};
            financialData.years.forEach(year => {
                const bs = financialData.balanceSheets[year];
                const is = financialData.incomeStatements[year];
                
                // 应收账款周转率 = 营业收入 / 应收账款
                const receivablesTurnover = bs.receivables ? is.revenue / bs.receivables : 0;
                
                // 存货周转率 = 营业成本 / 存货
                const inventoryTurnover = bs.inventory ? is.cost / bs.inventory : 0;
                
                // 总资产周转率 = 营业收入 / 总资产
                const assetTurnover = bs.totalAssets ? is.revenue / bs.totalAssets : 0;
                
                // 固定资产周转率 = 营业收入 / 固定资产
                const fixedAssetTurnover = bs.fixedAssets ? is.revenue / bs.fixedAssets : 0;
                
                financialIndicators.operation[year] = {
                    receivablesTurnover: parseFloat(receivablesTurnover.toFixed(2)),
                    inventoryTurnover: parseFloat(inventoryTurnover.toFixed(2)),
                    assetTurnover: parseFloat(assetTurnover.toFixed(2)),
                    fixedAssetTurnover: parseFloat(fixedAssetTurnover.toFixed(2))
                };
            });
            
            // 计算发展能力指标
            financialIndicators.growth = {};
            for (let i = 1; i < financialData.years.length; i++) {
                const year = financialData.years[i];
                const prevYear = financialData.years[i-1];
                
                const is = financialData.incomeStatements[year];
                const prevIs = financialData.incomeStatements[prevYear];
                
                // 营业收入增长率 = (本年营业收入 - 上年营业收入) / 上年营业收入
                const revenueGrowth = prevIs.revenue ? (is.revenue - prevIs.revenue) / prevIs.revenue : 0;
                
                // 净利润增长率 = (本年净利润 - 上年净利润) / 上年净利润
                const profitGrowth = prevIs.netProfit ? (is.netProfit - prevIs.netProfit) / prevIs.netProfit : 0;
                
                financialIndicators.growth[year] = {
                    revenueGrowth: parseFloat((revenueGrowth * 100).toFixed(1)),
                    profitGrowth: parseFloat((profitGrowth * 100).toFixed(1))
                };
            }
            
            // 计算现金流量指标
            financialIndicators.cashflow = {};
            financialData.years.forEach(year => {
                const bs = financialData.balanceSheets[year];
                const cf = financialData.cashFlowStatements[year];
                const is = financialData.incomeStatements[year];
                
                // 现金流动负债比率 = 经营活动现金流量净额 / 流动负债
                const cashFlowLiability = bs.currentLiabilities ? cf.operatingCashflow / bs.currentLiabilities : 0;
                
                // 现金流量比率 = 经营活动现金流量净额 / 流动负债
                const cashFlowRatio = bs.currentLiabilities ? cf.operatingCashflow / bs.currentLiabilities : 0;
                
                // 自由现金流比率 = (经营现金流净额 - 资本支出) ÷ 营业收入 × 100%
                const freeCashflowRatio = is.revenue ? ((cf.operatingCashflow - cf.capitalExpenditure) / is.revenue * 100) : 0;
                
                financialIndicators.cashflow[year] = {
                    cashFlowLiability: parseFloat((cashFlowLiability * 100).toFixed(1)),
                    cashFlowRatio: parseFloat(cashFlowRatio.toFixed(2)),
                    freeCashflowRatio: parseFloat(freeCashflowRatio.toFixed(1))
                };
            });
        }
        
        // 更新财务指标显示
        function updateFinancialIndicatorsDisplay() {
            const years = financialData.years;
            const lastYear = years[years.length - 1];
            const prevYear = years[years.length - 2];
            
            // 更新偿债能力指标
            years.forEach(year => {
                const solvency = financialIndicators.solvency[year];
                
                document.getElementById(`current-ratio-${year}`).textContent = solvency.currentRatio;
                document.getElementById(`quick-ratio-${year}`).textContent = solvency.quickRatio;
                document.getElementById(`cash-ratio-${year}`).textContent = solvency.cashRatio.toFixed(2);
                document.getElementById(`debt-ratio-${year}`).textContent = solvency.debtRatio + '%';
                document.getElementById(`interest-coverage-${year}`).textContent = solvency.interestCoverage.toFixed(2);
            });
            
            // 更新盈利能力指标
            years.forEach(year => {
                const profitability = financialIndicators.profitability[year];
                
                document.getElementById(`gross-margin-${year}`).textContent = profitability.grossMargin + '%';
                document.getElementById(`operating-margin-${year}`).textContent = profitability.operatingMargin + '%';
                document.getElementById(`net-margin-${year}`).textContent = profitability.netMargin + '%';
                document.getElementById(`roa-${year}`).textContent = profitability.roa + '%';
                document.getElementById(`roe-${year}`).textContent = profitability.roe + '%';
            });
            
            // 更新营运能力指标
            years.forEach(year => {
                const operation = financialIndicators.operation[year];
                
                document.getElementById(`receivables-turnover-${year}`).textContent = operation.receivablesTurnover.toFixed(2);
                document.getElementById(`inventory-turnover-${year}`).textContent = operation.inventoryTurnover.toFixed(2);
                document.getElementById(`asset-turnover-${year}`).textContent = operation.assetTurnover.toFixed(2);
                document.getElementById(`fixed-asset-turnover-${year}`).textContent = operation.fixedAssetTurnover.toFixed(2);
            });
            
            // 更新发展能力指标
            for (let i = 1; i < years.length; i++) {
                const year = years[i];
                const growth = financialIndicators.growth[year];
                
                if (growth) {
                    document.getElementById(`revenue-growth-${year}`).textContent = growth.revenueGrowth + '%';
                    document.getElementById(`profit-growth-${year}`).textContent = growth.profitGrowth + '%';
                }
            }
            
            // 更新现金流量指标
            years.forEach(year => {
                const cashflow = financialIndicators.cashflow[year];
                
                document.getElementById(`cash-flow-liability-${year}`).textContent = cashflow.cashFlowLiability + '%';
                document.getElementById(`cash-flow-ratio-${year}`).textContent = cashflow.cashFlowRatio.toFixed(2);
                document.getElementById(`free-cashflow-ratio-${year}`).textContent = cashflow.freeCashflowRatio.toFixed(1) + '%';
            });
            
            // 更新趋势和状态
            updateTrendsAndStatuses();
            
            // 更新顶部概览卡片
            const solvency = financialIndicators.solvency[lastYear];
            const profitability = financialIndicators.profitability[lastYear];
            const operation = financialIndicators.operation[lastYear];
            const cashflow = financialIndicators.cashflow[lastYear];
            
            document.getElementById('receivables-turnover-summary').textContent = operation.receivablesTurnover.toFixed(2);
            
            const debtRatioTrend = ((solvency.debtRatio - financialIndicators.solvency[prevYear].debtRatio) / 
                                   Math.abs(financialIndicators.solvency[prevYear].debtRatio) * 100);
            let debtTrendHtml = '';
            if (debtRatioTrend > 0) {
                debtTrendHtml = `<span class="trend-up">↑${Math.abs(debtRatioTrend).toFixed(2)}% <i class="fas fa-arrow-up"></i></span>`;
            } else if (debtRatioTrend < 0) {
                debtTrendHtml = `<span class="trend-down">↓${Math.abs(debtRatioTrend).toFixed(2)}% <i class="fas fa-arrow-down"></i></span>`;
            } else {
                debtTrendHtml = `<span>→ 0.00%</span>`;
            }
            document.getElementById('debt-trend').innerHTML = debtTrendHtml;
            
            document.getElementById('debt-ratio').textContent = solvency.debtRatio + '%';
            document.getElementById('roe').textContent = profitability.roe + '%';
            document.getElementById('free-cashflow-ratio').textContent = cashflow.freeCashflowRatio.toFixed(1) + '%';
            
            const receivablesTurnoverTrend = ((operation.receivablesTurnover - financialIndicators.operation[prevYear].receivablesTurnover) / 
                                            Math.abs(financialIndicators.operation[prevYear].receivablesTurnover) * 100);
            let receivablesTrendHtml = '';
            if (receivablesTurnoverTrend > 0) {
                receivablesTrendHtml = `<span class="trend-up">↑${Math.abs(receivablesTurnoverTrend).toFixed(2)}% <i class="fas fa-arrow-up"></i></span>`;
            } else if (receivablesTurnoverTrend < 0) {
                receivablesTrendHtml = `<span class="trend-down">↓${Math.abs(receivablesTurnoverTrend).toFixed(2)}% <i class="fas fa-arrow-down"></i></span>`;
            } else {
                receivablesTrendHtml = `<span>→ 0.00%</span>`;
            }
            document.getElementById('receivables-turnover-trend-summary').innerHTML = receivablesTrendHtml;
            
            // 更新沃尔评分
            updateWaltScoring();
            
            // 更新杜邦分析
            updateDuPontAnalysis();
            
            // 更新财务分析文本
            updateFinancialAnalysis();
        }
        
        // 更新趋势和状态
        function updateTrendsAndStatuses() {
            const years = financialData.years;
            const lastYear = years[years.length - 1];
            const prevYear = years[years.length - 2];
            
            // 偿债能力
            updateIndicatorTrend('current-ratio', years, '正向', 1.5, 1.8, 'solvency');
            updateIndicatorTrend('quick-ratio', years, '正向', 0.8, 1.0, 'solvency');
            updateIndicatorTrend('cash-ratio', years, '正向', 0.2, 0.3, 'solvency');
            updateIndicatorTrend('debt-ratio', years, '负向', 50, 60, 'solvency');
            updateIndicatorTrend('interest-coverage', years, '正向', 3, 5, 'solvency');
            
            // 盈利能力
            updateIndicatorTrend('gross-margin', years, '正向', 15, 20, 'profitability');
            updateIndicatorTrend('operating-margin', years, '正向', 8, 12, 'profitability');
            updateIndicatorTrend('net-margin', years, '正向', 5, 8, 'profitability');
            updateIndicatorTrend('roa', years, '正向', 5, 10, 'profitability');
            updateIndicatorTrend('roe', years, '正向', 10, 15, 'profitability');
            
            // 营运能力
            updateIndicatorTrend('receivables-turnover', years, '正向', 6, 8, 'operation');
            updateIndicatorTrend('inventory-turnover', years, '正向', 7, 9, 'operation');
            updateIndicatorTrend('asset-turnover', years, '正向', 0.8, 1.2, 'operation');
            updateIndicatorTrend('fixed-asset-turnover', years, '正向', 2, 3, 'operation');
            
            // 发展能力（只计算22-23年）
            updateIndicatorTrend('revenue-growth', years, '正向', 5, 8, 'growth');
            updateIndicatorTrend('profit-growth', years, '正向', 7, 10, 'growth');
            
            // 现金流量
            updateIndicatorTrend('cash-flow-liability', years, '正向', 40, 50, 'cashflow');
            updateIndicatorTrend('cash-flow-ratio', years, '正向', 0.3, 0.5, 'cashflow');
            updateIndicatorTrend('free-cashflow-ratio', years, '正向', 3, 6, 'cashflow');
        }
        
        // 指标名称到对象属性的映射
        function mapIndicatorToProperty(indicator) {
            const mappings = {
                'current-ratio': 'currentRatio',
                'quick-ratio': 'quickRatio',
                'cash-ratio': 'cashRatio',
                'debt-ratio': 'debtRatio',
                'interest-coverage': 'interestCoverage',
                'gross-margin': 'grossMargin',
                'operating-margin': 'operatingMargin',
                'net-margin': 'netMargin',
                'roa': 'roa',
                'roe': 'roe',
                'receivables-turnover': 'receivablesTurnover',
                'inventory-turnover': 'inventoryTurnover',
                'asset-turnover': 'assetTurnover',
                'fixed-asset-turnover': 'fixedAssetTurnover',
                'revenue-growth': 'revenueGrowth',
                'profit-growth': 'profitGrowth',
                'cash-flow-liability': 'cashFlowLiability',
                'cash-flow-ratio': 'cashFlowRatio',
                'free-cashflow-ratio': 'freeCashflowRatio'
            };
            
            return mappings[indicator] || indicator;
        }
        
        // 更新单个指标的趋势和状态
        function updateIndicatorTrend(indicator, years, direction, warningThreshold, goodThreshold, indicatorType) {
            const lastYear = years[years.length - 1];
            const prevYear = years[years.length - 2];
            
            // 获取属性名
            const property = mapIndicatorToProperty(indicator);
            
            // 获取当前指标在最近两年（2024和2023）的值
            let currentValue, prevValue;
            
            // 从正确的指标类别中获取值
            switch (indicatorType) {
                case 'solvency':
                    if (financialIndicators.solvency[lastYear] && financialIndicators.solvency[prevYear]) {
                        currentValue = financialIndicators.solvency[lastYear][property];
                        prevValue = financialIndicators.solvency[prevYear][property];
                    }
                    break;
                case 'profitability':
                    if (financialIndicators.profitability[lastYear] && financialIndicators.profitability[prevYear]) {
                        currentValue = financialIndicators.profitability[lastYear][property];
                        prevValue = financialIndicators.profitability[prevYear][property];
                    }
                    break;
                case 'operation':
                    if (financialIndicators.operation[lastYear] && financialIndicators.operation[prevYear]) {
                        currentValue = financialIndicators.operation[lastYear][property];
                        prevValue = financialIndicators.operation[prevYear][property];
                    }
                    break;
                case 'growth':
                    if (financialIndicators.growth[lastYear] && financialIndicators.growth[prevYear]) {
                        currentValue = financialIndicators.growth[lastYear][property];
                        prevValue = financialIndicators.growth[prevYear][property];
                    }
                    break;
                case 'cashflow':
                    if (financialIndicators.cashflow[lastYear] && financialIndicators.cashflow[prevYear]) {
                        currentValue = financialIndicators.cashflow[lastYear][property];
                        prevValue = financialIndicators.cashflow[prevYear][property];
                    }
                    break;
            }
            
            // 检查是否有有效数据
            if (prevValue === undefined || prevValue === 0 || isNaN(currentValue) || isNaN(prevValue)) {
                document.getElementById(`${indicator}-trend`).innerHTML = '<span>--</span>';
                // 更新状态（使用当前值）
                updateStatus(indicator, currentValue, direction, warningThreshold, goodThreshold);
                return;
            }
            
            // 计算趋势百分比
            const trendPercentage = ((currentValue - prevValue) / Math.abs(prevValue) * 100);
            
            // 更新趋势显示
            const trendElement = document.getElementById(`${indicator}-trend`);
            if (trendElement) {
                let arrowClass, arrowIcon, prefix;
                if (trendPercentage > 0) {
                    arrowClass = "trend-up";
                    arrowIcon  = "fa-arrow-up";
                    prefix     = "↑";
                } else if (trendPercentage < 0) {
                    arrowClass = "trend-down";
                    arrowIcon  = "fa-arrow-down";
                    prefix     = "↓";
                } else {
                    arrowClass = "";
                    arrowIcon  = "";
                    prefix     = "→";
                }
                trendElement.innerHTML =
                    `<span class="${arrowClass}">${prefix}${Math.abs(trendPercentage).toFixed(2)}% <i class="fas ${arrowIcon} trend-icon"></i></span>`;
            }
            
            // 更新状态（使用当前值）
            updateStatus(indicator, currentValue, direction, warningThreshold, goodThreshold);
        }
        
        // 更新状态
        function updateStatus(indicator, currentValue, direction, warningThreshold, goodThreshold) {
            const statusElement = document.getElementById(`${indicator}-status`);
            if (!statusElement) return;
            
            if (isNaN(currentValue)) {
                statusElement.innerHTML = `<span class="status-badge status-warning">N/A</span>`;
                return;
            }
            
            let statusClass, statusText;
            
            if (direction === '负向') {
                // 负向指标（越低越好）
                if (currentValue <= goodThreshold) {
                    statusClass = "status-good";
                    statusText = "优秀";
                } else if (currentValue <= warningThreshold) {
                    statusClass = "status-warning";
                    statusText = "良好";
                } else {
                    statusClass = "status-danger";
                    statusText = "危险";
                }
            } else {
                // 正向指标（越高越好）
                if (currentValue >= goodThreshold) {
                    statusClass = "status-good";
                    statusText = "优秀";
                } else if (currentValue >= warningThreshold) {
                    statusClass = "status-warning";
                    statusText = "良好";
                } else {
                    statusClass = "status-danger";
                    statusText = "危险";
                }
            }
            
            statusElement.innerHTML = `<span class="status-badge ${statusClass}">${statusText}</span>`;
        }
        
        // 更新沃尔评分 - 已修复负分问题
        function updateWaltScoring() {
            const lastYear = financialData.years[financialData.years.length - 1];
            const solvency = financialIndicators.solvency[lastYear];
            const profitability = financialIndicators.profitability[lastYear];
            const operation = financialIndicators.operation[lastYear];
            const growth = financialIndicators.growth[lastYear];
            const cashflow = financialIndicators.cashflow[lastYear];
            
            // 定义标准值
            const standards = {
                'current-ratio': 1.8,
                'debt-ratio': 60, // 标准值60%
                'roe': 15, // 15%
                'asset-turnover': 1.0,
                'revenue-growth': 7, // 7%
                'profit-growth': 9, // 9%
                'interest-coverage': 4.0,
                'cash-flow-liability': 45, // 45%
                'gross-margin': 18, // 18%
                'free-cashflow-ratio': 6 // 6%
            };
            
            // 计算各项得分
            const scores = {};
            let totalScore = 0;
            
            // 流动比率得分 - 添加0分下限
            scores['current-ratio'] = Math.max(0, Math.min((solvency.currentRatio / standards['current-ratio']) * 10, 10 * 1.2));
            
            // 资产负债率得分（负指标）- 添加0分下限
            scores['debt-ratio'] = Math.max(0, Math.min((standards['debt-ratio'] / solvency.debtRatio) * 10, 10 * 1.2));
            
            // 净资产收益率得分 - 添加0分下限
            scores['roe'] = Math.max(0, Math.min((profitability.roe / standards['roe']) * 15, 15 * 1.2));
            
            // 总资产周转率得分 - 添加0分下限
            scores['asset-turnover'] = Math.max(0, Math.min((operation.assetTurnover / standards['asset-turnover']) * 10, 10 * 1.2));
            
            // 营业收入增长率得分 - 添加0分下限
            scores['revenue-growth'] = Math.max(0, Math.min((growth.revenueGrowth / standards['revenue-growth']) * 8, 8 * 1.2));
            
            // 净利润增长率得分 - 添加0分下限
            scores['profit-growth'] = Math.max(0, Math.min((growth.profitGrowth / standards['profit-growth']) * 9, 9 * 1.2));
            
            // 利息保障倍数得分 - 添加0分下限
            scores['interest-coverage'] = Math.max(0, Math.min((solvency.interestCoverage / standards['interest-coverage']) * 8, 8 * 1.2));
            
            // 现金流动负债比率得分 - 添加0分下限
            scores['cash-flow-liability'] = Math.max(0, Math.min((cashflow.cashFlowLiability / standards['cash-flow-liability']) * 10, 10 * 1.2));
            
            // 毛利率得分 - 添加0分下限
            scores['gross-margin'] = Math.max(0, Math.min((profitability.grossMargin / standards['gross-margin']) * 9, 9 * 1.2));
            
            // 自由现金流比率得分 - 添加0分下限
            scores['free-cashflow-ratio'] = Math.max(0, Math.min((cashflow.freeCashflowRatio / standards['free-cashflow-ratio']) * 11, 11 * 1.2));
            
            // 计算总分
            Object.values(scores).forEach(score => {
                totalScore += score;
            });
            
            // 更新实际值
            document.getElementById('walt-current-ratio').textContent = solvency.currentRatio.toFixed(2);
            document.getElementById('walt-debt-ratio').textContent = solvency.debtRatio.toFixed(1) + '%';
            document.getElementById('walt-roe').textContent = profitability.roe.toFixed(1) + '%';
            document.getElementById('walt-asset-turnover').textContent = operation.assetTurnover.toFixed(2);
            document.getElementById('walt-revenue-growth').textContent = growth ? growth.revenueGrowth.toFixed(1) + '%' : 'N/A';
            document.getElementById('walt-profit-growth').textContent = growth ? growth.profitGrowth.toFixed(1) + '%' : 'N/A';
            document.getElementById('walt-interest-coverage').textContent = solvency.interestCoverage.toFixed(2);
            document.getElementById('walt-cash-flow-liability').textContent = cashflow.cashFlowLiability.toFixed(1) + '%';
            document.getElementById('walt-gross-margin').textContent = profitability.grossMargin.toFixed(1) + '%';
            document.getElementById('walt-free-cashflow-ratio').textContent = cashflow.freeCashflowRatio.toFixed(1) + '%';
            
            // 更新分数
            document.getElementById('walt-current-ratio-score').textContent = scores['current-ratio'].toFixed(2);
            document.getElementById('walt-debt-ratio-score').textContent = scores['debt-ratio'].toFixed(2);
            document.getElementById('walt-roe-score').textContent = scores['roe'].toFixed(2);
            document.getElementById('walt-asset-turnover-score').textContent = scores['asset-turnover'].toFixed(2);
            document.getElementById('walt-revenue-growth-score').textContent = scores['revenue-growth'].toFixed(2);
            document.getElementById('walt-profit-growth-score').textContent = scores['profit-growth'].toFixed(2);
            document.getElementById('walt-interest-coverage-score').textContent = scores['interest-coverage'].toFixed(2);
            document.getElementById('walt-cash-flow-liability-score').textContent = scores['cash-flow-liability'].toFixed(2);
            document.getElementById('walt-gross-margin-score').textContent = scores['gross-margin'].toFixed(2);
            document.getElementById('walt-free-cashflow-ratio-score').textContent = scores['free-cashflow-ratio'].toFixed(2);
            
            // 更新总分
            document.getElementById('walt-total-score').textContent = totalScore.toFixed(2);
            document.getElementById('walt-score-value').textContent = totalScore.toFixed(2);
            
            // 更新状态
            let status, badgeClass, statusText;
            if (totalScore >= 100) {
                status = "优秀";
                badgeClass = "bg-success";
                statusText = "该企业综合评分优秀，财务综合状况优异";
            } else if (totalScore >= 90) {
                status = "良好";
                badgeClass = "bg-info";
                statusText = "该企业综合评分良好，财务综合状况良好";
            } else if (totalScore >= 80) {
                status = "一般";
                badgeClass = "bg-warning";
                statusText = "该企业综合评分一般，存在一定财务风险";
            } else {
                status = "较差";
                badgeClass = "bg-danger";
                statusText = "该企业综合评分较差，财务风险较高";
            }
            
            document.getElementById('walt-total-status').textContent = status;
            document.getElementById('walt-score-badge').textContent = status;
            document.getElementById('walt-score-badge').className = `badge ${badgeClass} fs-5 p-2`;
            document.getElementById('walt-evaluation').innerHTML = `<strong>评估说明：</strong>${statusText}。`;
            
            // 更新各项指标状态
            updateWaltStatus('current-ratio', scores['current-ratio'], 10, 8.2, 6.5);
            updateWaltStatus('debt-ratio', scores['debt-ratio'], 10, 9, 7);
            updateWaltStatus('roe', scores['roe'], 15, 13.5, 11);
            updateWaltStatus('asset-turnover', scores['asset-turnover'], 10, 9, 7);
            updateWaltStatus('revenue-growth', scores['revenue-growth'], 8, 7, 5);
            updateWaltStatus('profit-growth', scores['profit-growth'], 9, 8, 6);
            updateWaltStatus('interest-coverage', scores['interest-coverage'], 8, 7.2, 6.4);
            updateWaltStatus('cash-flow-liability', scores['cash-flow-liability'], 10, 9, 8);
            updateWaltStatus('gross-margin', scores['gross-margin'], 9, 7.2, 6.4);
            updateWaltStatus('free-cashflow-ratio', scores['free-cashflow-ratio'], 11, 9.9, 8);
        }
        
        // 更新沃尔评分各项状态
        function updateWaltStatus(indicator, score, maxScore, goodThreshold, warningThreshold) {
            const statusElement = document.getElementById(`walt-${indicator}-status`);
            if (!statusElement) return;

            let statusClass, statusText;
            
            if (score >= goodThreshold) {
                statusClass = "status-good";
                statusText = "优秀";
            } else if (score >= warningThreshold) {
                statusClass = "status-warning";
                statusText = "良好";
            } else {
                statusClass = "status-danger";
                statusText = "危险";
            }
            
            statusElement.innerHTML = `<span class="status-badge ${statusClass}">${statusText}</span>`;
        }
        
        // 更新杜邦分析
        function updateDuPontAnalysis() {
            const lastYear = financialData.years[financialData.years.length - 1];
            const profitability = financialIndicators.profitability[lastYear];
            const operation = financialIndicators.operation[lastYear];
            const bs = financialData.balanceSheets[lastYear];
            
            // 计算权益乘数
            const equityMultiplier = bs.totalAssets / bs.equity;
            
            // 更新显示
            document.getElementById('dupont-roe').textContent = profitability.roe.toFixed(1) + '%';
            document.getElementById('dupont-net-margin').textContent = profitability.netMargin.toFixed(1) + '%';
            document.getElementById('dupont-asset-turnover').textContent = operation.assetTurnover.toFixed(2);
            document.getElementById('dupont-equity-multiplier').textContent = equityMultiplier.toFixed(2);
            
            // 更新分析文本
            document.getElementById('dupont-analysis').textContent = 
                `该企业${lastYear}年净资产收益率(ROE)为${profitability.roe.toFixed(1)}%，表现优异。从杜邦分析体系分解来看：`;
        }
        
        // 更新财务分析文本
        function updateFinancialAnalysis() {
            const lastYear = financialData.years[financialData.years.length - 1];
            const solvency = financialIndicators.solvency[lastYear];
            const profitability = financialIndicators.profitability[lastYear];
            const operation = financialIndicators.operation[lastYear];
            const growth = financialIndicators.growth[lastYear];
            const cashflow = financialIndicators.cashflow[lastYear];
            
            // 偿债能力分析
            document.getElementById('solvency-analysis').textContent = 
                `该企业${lastYear}年流动比率为${solvency.currentRatio.toFixed(2)}，${solvency.currentRatio < 1.5 ? '低于' : '高于'}行业平均水平(1.8)，${solvency.currentRatio < 1.5 ? '短期偿债能力存在一定风险' : '短期偿债能力良好'}。速动比率${solvency.quickRatio.toFixed(2)}${solvency.quickRatio < 1 ? '低于安全水平(1)' : '处于安全水平'}, 资产负债率${solvency.debtRatio.toFixed(1)}%处于合理范围，利息保障倍数${solvency.interestCoverage.toFixed(2)}表现${solvency.interestCoverage > 4 ? '良好' : '一般'}，长期偿债能力${solvency.interestCoverage > 4 ? '稳定' : '存在风险'}。`;
            
            // 盈利能力分析
            document.getElementById('profitability-analysis').textContent = 
                `近三年毛利率稳定在${profitability.grossMargin.toFixed(1)}%左右，${profitability.grossMargin > 18 ? '高于' : '低于'}行业平均(18%)。净利率保持在${profitability.netMargin.toFixed(1)}%左右，净资产收益率${profitability.roe.toFixed(1)}%表现${profitability.roe > 25 ? '优异' : '良好'}。总资产报酬率${profitability.roa.toFixed(1)}%${profitability.roa > 12 ? '高于' : '低于'}行业平均(12%)，资产利用效率${profitability.roa > 12 ? '较高' : '一般'}。`;
            
            // 营运能力分析
            document.getElementById('operation-analysis').textContent = 
                `应收账款周转率${operation.receivablesTurnover.toFixed(2)}次，${operation.receivablesTurnover > 10.5 ? '高于' : '低于'}行业平均(10.5次)。存货周转率${operation.inventoryTurnover.toFixed(2)}次，固定资产周转率${operation.fixedAssetTurnover.toFixed(2)}次，${operation.inventoryTurnover > 7 && operation.fixedAssetTurnover > 2.5 ? '均高于行业平均水平' : '处于行业平均水平'}。总资产周转率${operation.assetTurnover.toFixed(2)}次，资产使用效率${operation.assetTurnover > 1.2 ? '较高' : '一般'}。`;
            
            // 发展能力分析
            let growthText = '';
            if (growth) {
                growthText = `2024年营业收入增长率为${growth.revenueGrowth.toFixed(1)}%，${growth.revenueGrowth > 9.5 ? '高于' : '低于'}行业平均(9.5%)。净利润增长率${growth.profitGrowth.toFixed(1)}%，${growth.profitGrowth > growth.revenueGrowth ? '高于营业收入增速' : '低于营业收入增速'}，自由现金流比率${cashflow.freeCashflowRatio.toFixed(1)}%，${cashflow.freeCashflowRatio > 5 ? '表现良好' : '需关注投资扩张带来的现金流压力'}。`;
            } else {
                growthText = '发展能力数据不足，无法进行完整分析。';
            }
            document.getElementById('growth-analysis').textContent = growthText;
            
            // 综合评估
            let rating = '';
            if (profitability.roe > 25 && solvency.debtRatio < 55 && operation.assetTurnover > 1.2) {
                rating = 'A- (良好)';
            } else if (profitability.roe > 20 && solvency.debtRatio < 60 && operation.assetTurnover > 1.0) {
                rating = 'B+ (一般)';
            } else {
                rating = 'C (需要关注)';
            }
            
            // 更新综合评估内容
            document.getElementById('overall-assessment').textContent = 
                `该企业整体财务状况${profitability.roe > 20 ? '良好' : '存在风险'}，盈利能力${profitability.roe > 25 ? '突出' : profitability.roe > 20 ? '良好' : '一般'}，资产使用效率${operation.assetTurnover > 1.2 ? '较高' : '一般'}。主要${solvency.currentRatio < 1.5 ? '风险点在于短期偿债能力偏弱' : '优势在于流动性良好'}。${growth ? `发展速度${growth.revenueGrowth > 9.5 ? '高于' : '略低于'}行业平均水平` : ''}。`;
            
            document.getElementById('rating-badge').textContent = rating;
        }
        
        // 保存并计算
        function saveAndCalculate() {
            // 显示加载状态
            document.getElementById('loadingOverlay').style.display = 'flex';
            
            // 模拟计算延迟
            setTimeout(() => {
                try {
                    // 收集数据
                    collectFinancialData();
                    
                    // 计算指标
                    calculateFinancialIndicators();
                    
                    // 更新显示
                    updateFinancialIndicatorsDisplay();
                    
                    // 更新图表
                    updateCharts();
                    
                    // 隐藏加载状态
                    document.getElementById('loadingOverlay').style.display = 'none';
                    
                    // 显示成功消息
                    const successAlert = document.getElementById('successAlert');
                    successAlert.style.display = 'block';
                    
                    // 3秒后自动隐藏
                    setTimeout(() => {
                        successAlert.style.display = 'none';
                    }, 3000);
                } catch (error) {
                    console.error('保存并计算出错:', error);
                    document.getElementById('loadingOverlay').style.display = 'none';
                    
                    // 显示错误消息
                    const errorAlert = document.getElementById('errorAlert');
                    document.getElementById('errorMessage').textContent = '计算过程中发生错误';
                    errorAlert.style.display = 'block';
                    
                    setTimeout(() => {
                        errorAlert.style.display = 'none';
                    }, 3000);
                }
            }, 1500); // 1.5秒延迟模拟计算过程
        }
        
        // 初始化图表
        function initializeCharts() {
            // 偿债能力图表
            const solvencyCtx = document.getElementById('solvencyChart').getContext('2d');
            solvencyChart = new Chart(solvencyCtx, {
                type: 'line',
                data: {
                    labels: financialData.years,
                    datasets: [
                        {
                            label: '流动比率',
                            data: [],
                            borderColor: '#3498db',
                            backgroundColor: 'rgba(52, 152, 219, 0.1)',
                            tension: 0.3,
                            fill: true
                        },
                        {
                            label: '速动比率',
                            data: [],
                            borderColor: '#e74c3c',
                            backgroundColor: 'rgba(231, 76, 60, 0.1)',
                            tension: 0.3,
                            fill: true
                        },
                        {
                            label: '资产负债率(%)',
                            data: [],
                            borderColor: '#2ecc71',
                            backgroundColor: 'rgba(46, 204, 113, 0.1)',
                            tension: 0.3,
                            fill: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: false,
                            title: {
                                display: true,
                                text: '比率值'
                            }
                        }
                    }
                }
            });
            
            // 盈利能力图表
            const profitabilityCtx = document.getElementById('profitabilityChart').getContext('2d');
            profitabilityChart = new Chart(profitabilityCtx, {
                type: 'line',
                data: {
                    labels: financialData.years,
                    datasets: [
                        {
                            label: '毛利率(%)',
                            data: [],
                            borderColor: '#9b59b6',
                            backgroundColor: 'rgba(155, 89, 182, 0.1)',
                            tension: 0.3,
                            fill: true
                        },
                        {
                            label: '净利率(%)',
                            data: [],
                            borderColor: '#1abc9c',
                            backgroundColor: 'rgba(26, 188, 156, 0.1)',
                            tension: 0.3,
                            fill: true
                        },
                        {
                            label: 'ROE(%)',
                            data: [],
                            borderColor: '#f39c12',
                            backgroundColor: 'rgba(243, 156, 18, 0.1)',
                            tension: 0.3,
                            fill: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: false,
                            title: {
                                display: true,
                                text: '百分比(%)'
                            }
                        }
                    }
                }
            });
            
            // 营运能力图表
            const operationCtx = document.getElementById('operationChart').getContext('2d');
            operationChart = new Chart(operationCtx, {
                type: 'line',
                data: {
                    labels: financialData.years,
                    datasets: [
                        {
                            label: '应收账款周转率',
                            data: [],
                            borderColor: '#e74c3c',
                            backgroundColor: 'rgba(231, 76, 60, 0.1)',
                            tension: 0.3,
                            fill: true
                        },
                        {
                            label: '存货周转率',
                            data: [],
                            borderColor: '#3498db',
                            backgroundColor: 'rgba(52, 152, 219, 0.1)',
                            tension: 0.3,
                            fill: true
                        },
                        {
                            label: '总资产周转率',
                            data: [],
                            borderColor: '#2ecc71',
                            backgroundColor: 'rgba(46, 204, 113, 0.1)',
                            tension: 0.3,
                            fill: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: false,
                            title: {
                                display: true,
                                text: '周转率'
                            }
                        }
                    }
                }
            });
            
            // 发展能力图表
            const growthCtx = document.getElementById('growthChart').getContext('2d');
            growthChart = new Chart(growthCtx, {
                type: 'line',
                data: {
                    labels: financialData.years.slice(1),
                    datasets: [
                        {
                            label: '营业收入增长率(%)',
                            data: [],
                            borderColor: '#9b59b6',
                            backgroundColor: 'rgba(155, 89, 182, 0.1)',
                            tension: 0.3,
                            fill: true
                        },
                        {
                            label: '净利润增长率(%)',
                            data: [],
                            borderColor: '#f39c12',
                            backgroundColor: 'rgba(243, 156, 18, 0.1)',
                            tension: 0.3,
                            fill: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: false,
                            title: {
                                display: true,
                                text: '增长率(%)'
                            }
                        }
                    }
                }
            });
            
            // 沃尔评分行业对比图
            const industryCtx = document.getElementById('industryChart').getContext('2d');
            industryChart = new Chart(industryCtx, {
                type: 'bar',
                data: {
                    labels: ['投标单位', '行业平均', '行业优秀值'],
                    datasets: [{
                        label: '沃尔评分',
                        data: [0, 0, 0],
                        backgroundColor: [
                            'rgba(52, 152, 219, 0.7)',
                            'rgba(149, 165, 166, 0.7)',
                            'rgba(46, 204, 113, 0.7)'
                        ],
                        borderColor: [
                            'rgb(52, 152, 219)',
                            'rgb(149, 165, 166)',
                            'rgb(46, 204, 113)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true
                        }
                    }
                }
            });
            
            // 杜邦分析图表
            const profitMarginCtx = document.getElementById('profitMarginChart').getContext('2d');
            profitMarginChart = new Chart(profitMarginCtx, {
                type: 'doughnut',
                data: {
                    labels: ['净利率', '其他'],
                    datasets: [{
                        data: [0, 100],
                        backgroundColor: [
                            'rgba(52, 152, 219, 0.7)',
                            'rgba(220, 220, 220, 0.5)'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    cutout: '70%',
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
            
            const assetTurnoverCtx = document.getElementById('assetTurnoverChart').getContext('2d');
            assetTurnoverChart = new Chart(assetTurnoverCtx, {
                type: 'doughnut',
                data: {
                    labels: ['总资产周转率', '其他'],
                    datasets: [{
                        data: [0, 100],
                        backgroundColor: [
                            'rgba(46, 204, 113, 0.7)',
                            'rgba(220, 220, 220, 0.5)'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    cutout: '70%',
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
            
            const equityMultiplierCtx = document.getElementById('equityMultiplierChart').getContext('2d');
            equityMultiplierChart = new Chart(equityMultiplierCtx, {
                type: 'doughnut',
                data: {
                    labels: ['权益乘数', '其他'],
                    datasets: [{
                        data: [0, 100],
                        backgroundColor: [
                            'rgba(155, 89, 182, 0.7)',
                            'rgba(220, 220, 220, 0.5)'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    cutout: '70%',
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }
        
        // 更新图表数据
        function updateCharts() {
            // 偿债能力图表
            solvencyChart.data.datasets[0].data = financialData.years.map(year => financialIndicators.solvency[year].currentRatio);
            solvencyChart.data.datasets[1].data = financialData.years.map(year => financialIndicators.solvency[year].quickRatio);
            solvencyChart.data.datasets[2].data = financialData.years.map(year => financialIndicators.solvency[year].debtRatio);
            solvencyChart.update();
            
            // 盈利能力图表
            profitabilityChart.data.datasets[0].data = financialData.years.map(year => financialIndicators.profitability[year].grossMargin);
            profitabilityChart.data.datasets[1].data = financialData.years.map(year => financialIndicators.profitability[year].netMargin);
            profitabilityChart.data.datasets[2].data = financialData.years.map(year => financialIndicators.profitability[year].roe);
            profitabilityChart.update();
            
            // 营运能力图表
            operationChart.data.datasets[0].data = financialData.years.map(year => financialIndicators.operation[year].receivablesTurnover);
            operationChart.data.datasets[1].data = financialData.years.map(year => financialIndicators.operation[year].inventoryTurnover);
            operationChart.data.datasets[2].data = financialData.years.map(year => financialIndicators.operation[year].assetTurnover);
            operationChart.update();
            
            // 发展能力图表
            const growthYears = financialData.years.slice(1);
            growthChart.data.datasets[0].data = growthYears.map(year => financialIndicators.growth[year]?.revenueGrowth || 0);
            growthChart.data.datasets[1].data = growthYears.map(year => financialIndicators.growth[year]?.profitGrowth || 0);
            growthChart.update();
            
            // 沃尔评分行业对比
            const waltScore = parseFloat(document.getElementById('walt-total-score').textContent);
            industryChart.data.datasets[0].data = [waltScore, 95.8, 130.2];
            industryChart.update();
            
            // 杜邦分析图表
            const netMargin = parseFloat(document.getElementById('dupont-net-margin').textContent);
            const assetTurnover = parseFloat(document.getElementById('dupont-asset-turnover').textContent);
            const equityMultiplier = parseFloat(document.getElementById('dupont-equity-multiplier').textContent);
            
            profitMarginChart.data.datasets[0].data = [netMargin, 100 - netMargin];
            assetTurnoverChart.data.datasets[0].data = [assetTurnover * 50, 100 - assetTurnover * 50];
            equityMultiplierChart.data.datasets[0].data = [equityMultiplier * 30, 100 - equityMultiplier * 30];
            
            profitMarginChart.update();
            assetTurnoverChart.update();
            equityMultiplierChart.update();
        }
        
        // 导出报告
        function exportReport(target) {
            // 显示加载状态
            document.getElementById('loadingOverlay').style.display = 'flex';
            document.querySelector('#loadingOverlay p').textContent = '正在生成报告...';
            
            // 获取对应模块元素
            const element = document.getElementById(target);
            if (!element) {
                document.getElementById('loadingOverlay').style.display = 'none';
                return;
            }
            
            // 切换至对应标签页
            const tabTrigger = document.querySelector(`#${target}-tab`);
            if (tabTrigger) {
                const tab = new bootstrap.Tab(tabTrigger);
                tab.show();
            }
            
            // 等待标签页切换完成
            setTimeout(() => {
                // 使用html2canvas生成截图
                html2canvas(element, {
                    scale: 2,
                    useCORS: true,
                    allowTaint: true,
                    scrollY: 0,
                    logging: true
                }).then(canvas => {
                    const imgData = canvas.toDataURL('image/jpeg', 1.0);
                    
                    // 使用jsPDF生成PDF
                    const { jsPDF } = window.jspdf;
                    const pdf = new jsPDF('p', 'mm', 'a4');
                    const imgWidth = pdf.internal.pageSize.getWidth();
                    const imgHeight = canvas.height * imgWidth / canvas.width;
                    
                    // 添加图片到PDF
                    pdf.addImage(imgData, 'JPEG', 0, 0, imgWidth, imgHeight);
                    
                    // 保存PDF文件
                    pdf.save(`${financialData.company}-${target}-report.pdf`);
                    
                    // 隐藏加载状态
                    document.getElementById('loadingOverlay').style.display = 'none';
                }).catch(error => {
                    console.error('导出失败:', error);
                    document.getElementById('loadingOverlay').style.display = 'none';
                    
                    // 显示错误消息
                    const errorAlert = document.getElementById('errorAlert');
                    document.getElementById('errorMessage').textContent = '导出失败，请重试';
                    errorAlert.style.display = 'block';
                    
                    // 3秒后自动隐藏
                    setTimeout(() => {
                        errorAlert.style.display = 'none';
                    }, 3000);
                });
            }, 500);
        }
        
        // 公司选择事件
        document.getElementById('company-select').addEventListener('change', function() {
            if(this.value === 'new') {
                const name = prompt('请输入新单位名称：');
                if(name) {
                    const option = document.createElement('option');
                    option.value = 'new-company';
                    option.textContent = name;
                    option.selected = true;
                    this.appendChild(option);
                    financialData.company = name;
                } else {
                    this.value = 'company1';
                }
            } else {
                financialData.company = this.options[this.selectedIndex].text;
            }
        });
        
        // 更新单位显示
        function updateUnitDisplay(unit) {
            // 这里可以添加单位转换逻辑
            console.log('单位已切换为:', unit);
        }
    </script>
</body>
</html>